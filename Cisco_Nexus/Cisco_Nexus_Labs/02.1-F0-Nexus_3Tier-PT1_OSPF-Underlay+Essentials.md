# üß†üèóÔ∏èüåê Cisco Nexus: `NX-OS - Tier 3 Fabric PT1 : OSPF Overlay + Essential Configs`

![My Video](https://user-images.githubusercontent.com/94720207/165892585-b830998d-d7c5-43b4-a3ad-f71a07b9077e.gif)

### üê¶ Twitter  : [@fz3r0_OPs](https://twitter.com/Fz3r0_OPs)
### üê± Github  : [Fz3r0](https://github.com/fz3r0) 

---
 
#### Keywords: `Cisco` `CCNA` `CCNP` `Datacenter` `NX-OS` `Cisco Nexus` `Leaf & Spine` `DC Switching` `Modular Chassis` `Fixed Form Factor` `vPC` `ECMP` `FEX` `Fabric Extender` `Nexus 2000` `Nexus 5000` `Nexus 7000` `Nexus 9000`  `Port-Channel` `LAG` `VLAN` `VRF` `Overlay` `Underlay` `EVPN` `VXLAN`  `Spine Switch` `Leaf Switch` `Control Plane` `Forwarding Plane` `Supervisor Card` `Line Card`  `Redundant Power Supply` `Hot-swappable` `In-Service Software Upgrade (ISSU)` `High Availability`  `Twinax Cable` `SFP+` `QSFP28` `QSFP-DD` `10G` `25G` `40G` `100G` `400G`

---

<br>

# üìÑ `Index`



[**üóÉÔ∏è Resources**](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/01-F0-Nexus_DC-CollapsedCore-HA.md#%EF%B8%8F-resources)

# üèóÔ∏è Cisco Nexus :: `NX-OS - Tier 3 Fabric PT1 : OSPF Overlay + Essential Configs`



## üéØ Objectives, Features & Protocols Covered



## üé• Lab Proof of Concept (PoC) - Video

- [**üëâ Click here to go to the PoC video üëà**](https://youtu.be/RL9hBT0H7UE)

## üó∫Ô∏è Network Topology

![image](https://github.com/user-attachments/assets/53b6e40f-39e7-442e-b07b-3691feee6170)

![image](https://github.com/user-attachments/assets/18c5d0a9-3c8f-499b-9d39-29cb412fd39a)



## üìã Network Device Inventory & IP Addressing



## üìù Lab Notes

Credentials:

- Admin: `admin`
- Pass: `Adm1n.C1sc0`

Notes:

- During Nexus Switches start-up, select `skip` during "Abort Power On Auto Provisioning (yes - continue with normal setup, skip - bypass password and basic configuration, no - continue with Power On Auto Provisioning) (yes/skip/no)[no]: `skip`"
- The NX9-1 and NX9-2 must be powered on and configured before the edge routers, otherwise OSPF process 1 could bug/error.
- Check that all virtual NX devices are powered on and have no CLI issues; sometimes they can hang or freeze when too many sessions are open or multiple processes are running.

# **‚öôÔ∏è Devices Configurations**

- Copy & Paste the configuration in each device CLI

## ü•á `NX9-1-CR-ACT` - (Switch NX9-1 - CORE: ACTIVE HSRP (Priority 200))
























## üîÄ `vEDGE-1` - (Router 1 - SDWAN Edge) 

````py
!# Namings

enable
configure terminal
hostname vEDGE-1

!# Interfaces

#! L3 WAN INTERFACES @ CORE/LAN + OSPF FULL MESH

#! OSPF BEST PREFERENCE (1) @ NX9-1-CORE-PRIMARY
interface Ethernet0/1
   no shutdown
   duplex full
   description ** Link-to-NX9-1-CORE **
   ip address 10.10.0.1 255.255.255.252
   ip ospf network point-to-point
   ip ospf cost 1
   ip ospf hello-interval 1
   ip ospf dead-interval 4
   ip nat inside
exit

#! OSPF MEDIUM PREFERENCE (100) @ NX9-2-CORE-SECONDARY
interface Ethernet0/2
   no shutdown
   duplex full
   description ** Link-to-NX9-2-CORE **
   ip address 10.30.0.1 255.255.255.252
   ip ospf network point-to-point
   ip ospf cost 100
   ip ospf hello-interval 1
   ip ospf dead-interval 4
   ip nat inside
exit

#! OSPF WORST PREFERENCE (200) @ RT2 (WAN2)
interface Ethernet0/3
   no shutdown
   duplex full
   description ** RT1-RT2-Edge-to-Edge-Link **
   ip address 10.60.0.1 255.255.255.252
   ip ospf network point-to-point
   ip ospf cost 200
   ip ospf hello-interval 1
   ip ospf dead-interval 4
   ip nat inside
exit

!# WAN INTERFACE (NAT OUTSIDE) [Default Route @ Internet]

interface Ethernet0/0
   no shutdown
   duplex full
   description ** Link-to-WAN-1_INTERNET **
   ip address 123.1.1.2 255.255.255.252
   ip nat outside
exit

!# Ruta por defecto hacia la nube Google
ip route 0.0.0.0 0.0.0.0 123.1.1.1

!# NAT Inside/Outside ACL 10

access-list 10 permit 10.20.0.0 0.0.0.3
access-list 10 permit 10.40.0.0 0.0.0.3
access-list 10 permit 10.50.0.0 0.0.0.3

access-list 10 permit 10.10.0.0 0.0.0.3
access-list 10 permit 10.30.0.0 0.0.0.3
access-list 10 permit 10.60.0.0 0.0.0.3

access-list 10 permit 192.168.10.0 0.0.0.255
access-list 10 permit 192.168.20.0 0.0.0.255
access-list 10 permit 192.168.30.0 0.0.0.255

!# Overload all matching inside traffic to the WAN interface address
ip nat inside source list 10 interface Ethernet0/0 overload

!# OSPF Area 0 : Anuncia las redes LAN y P2P
router ospf 1

    !# Router ID (OSPF)
    router-id 3.3.3.3

    !# enlace hacia NX9-1
    network 10.10.0.0 0.0.0.3 area 0
    !# enlace hacia NX9-2
    network 10.30.0.0 0.0.0.3 area 0
    !# enlace Edge-to-Edge
    network 10.60.0.0 0.0.0.3 area 0

    !# VLAN10       
    network 192.168.10.0 0.0.0.255 area 0
    !# VLAN20  
    network 192.168.20.0 0.0.0.255 area 0
    !# VLAN30
    network 192.168.30.0 0.0.0.255 area 0

    !# RT1 - Outside WAN
    network 123.1.1.0 0.0.0.3 area 0

    !# RT2 - to MPLS (No NAT) (Network: 10.100.0.0)
    network 10.100.0.0 0.0.0.3 area 0

    !# propaga la ruta por defecto      
    default-information originate always

    !# redistribuye las rutas est√°ticas (MPLS)
    redistribute static subnets
exit

!# MPLS INTERFACE (Static Private Address) [Static Route @ MPLS]

!# MPLS INTERFACE 
interface Ethernet1/0
   no shutdown
   duplex full
   description ** Link-to-MPLS-1 **
   ip address 10.100.0.2 255.255.255.252
exit

!# MPLS STATIC ROUTES @ MPLS CIRCUITS
ip route 10.200.0.100 255.255.255.255 10.100.0.1
ip route 10.210.0.100 255.255.255.255 10.100.0.1

end
write memory

!
!


````

## üîÄ `RT-2-EDGE` - (Router 2 Edge) 

````py
!# Namings

enable
configure terminal
hostname RT-2-EDGE

!# Interfaces

#! L3 WAN INTERFACES @ CORE/LAN + OSPF FULL MESH

#! OSPF BEST PREFERENCE (1) @ NX9-2-CORE-SECONDARY
interface Ethernet0/1
   no shutdown
   duplex full
   description ** Link-to-NX9-2-CORE **
   ip address 10.20.0.1 255.255.255.252
   ip ospf network point-to-point
   ip ospf cost 1
   ip ospf hello-interval 1
   ip ospf dead-interval 4
   ip nat inside
exit

#! OSPF MEDIUM PREFERENCE (100) @ NX9-1-CORE-PRIMARY
interface Ethernet0/2
   no shutdown
   duplex full
   description ** Link-to-NX9-1-CORE **
   ip address 10.40.0.2 255.255.255.252
   ip ospf network point-to-point
   ip ospf cost 100
   ip ospf hello-interval 1
   ip ospf dead-interval 4
   ip nat inside
exit

#! OSPF WORST PREFERENCE (200) @ RT1 (WAN1)
interface Ethernet0/3
   no shutdown
   duplex full
   description ** RT1-RT2-Edge-to-Edge-Link **
   ip address 10.60.0.2 255.255.255.252
   ip ospf network point-to-point
   ip ospf cost 200
   ip ospf hello-interval 1
   ip ospf dead-interval 4
   ip nat inside
exit

!# WAN INTERFACE (NAT OUTSIDE) [Default Route @ Internet]

interface Ethernet0/0
   no shutdown
   duplex full
   description ** Link-to-WAN-2_INTERNET **
   ip address 123.2.2.2 255.255.255.252
   ip nat outside
exit

!# Ruta por defecto hacia la nube Google
ip route 0.0.0.0 0.0.0.0 123.2.2.1

!# NAT Inside/Outside ACL 10
access-list 10 permit 10.10.0.0 0.0.0.3
access-list 10 permit 10.30.0.0 0.0.0.3
access-list 10 permit 10.50.0.0 0.0.0.3

access-list 10 permit 10.20.0.0 0.0.0.3
access-list 10 permit 10.40.0.0 0.0.0.3
access-list 10 permit 10.60.0.0 0.0.0.3
access-list 10 permit 192.168.10.0 0.0.0.255
access-list 10 permit 192.168.20.0 0.0.0.255
access-list 10 permit 192.168.30.0 0.0.0.255

!# Overload all matching inside traffic to the WAN interface address
ip nat inside source list 10 interface Ethernet0/0 overload

!# OSPF Area 0 : Anuncia las redes LAN y P2P
router ospf 1

    !# Router ID (OSPF)
    router-id 4.4.4.4

    !# enlace hacia NX9-2
    network 10.20.0.0 0.0.0.3 area 0
    !# enlace hacia NX9-1
    network 10.40.0.0 0.0.0.3 area 0
    !# enlace Edge-to-Edge
    network 10.60.0.0 0.0.0.3 area 0

    !# VLAN10       
    network 192.168.10.0 0.0.0.255 area 0
    !# VLAN20  
    network 192.168.20.0 0.0.0.255 area 0
    !# VLAN30
    network 192.168.30.0 0.0.0.255 area 0

    !# RT2 - Outside WAN
    network 123.2.2.0 0.0.0.3 area 0

    !# RT2 - to MPLS (No NAT) (Network: 10.100.0.4)
    network 10.100.0.4 0.0.0.3 area 0

    !# propaga la ruta por defecto      
    default-information originate always

    !# redistribuye las rutas est√°ticas (MPLS)
    redistribute static subnets
       
exit

!# MPLS INTERFACE (Static Private Address) [Static Route @ MPLS]

!# MPLS INTERFACE 
interface Ethernet1/0
   no shutdown
   description ** Link-to-MPLS-2 **
   ip address 10.100.0.6 255.255.255.252
   duplex full
exit

!# MPLS STATIC ROUTES @ MPLS CIRCUITS
ip route 10.200.0.100 255.255.255.255 10.100.0.5
ip route 10.210.0.100 255.255.255.255 10.100.0.5

end
write memory

!
!


````










## üåé `WAN-1` - (ACTIVE Internet Circuit)

````py
!###############
!# WAN-1 (IOS) #
!###############

!# Namings
enable
configure terminal
hostname WAN-1

!# WAN Interface
interface Ethernet0/0
  no shutdown
  duplex full  
  description LINK-TO-NETWORK
  ip address 123.1.1.1 255.255.255.252

exit

!# Loopbacks (Google)
interface Loopback0
  description ** GOOGLE-DNS-1 **
  ip address 8.8.8.8 255.255.255.255
exit
interface Loopback1
  description ** GOOGLE-DNS-2 **
  ip address 8.8.4.4 255.255.255.255
exit

!# Default Route (opcional si usas default-route en el otro router)
ip route 0.0.0.0 0.0.0.0 123.1.1.2

end
write memory

!
!


````


## üåé `WAN-2` - (STAND-BY Internet Circuit)



````py
!###############
!# WAN-2 (IOS) #
!###############

!# Namings
enable
configure terminal
hostname WAN-2

!# WAN Interface
interface Ethernet0/0
  no shutdown
  duplex full
  description LINK-TO-NETWORK
  ip address 123.2.2.1 255.255.255.252
exit

!# Loopbacks (Google)
interface Loopback0
  description ** GOOGLE-DNS-1 **
  ip address 8.8.8.8 255.255.255.255
exit
interface Loopback1
  description ** GOOGLE-DNS-2 **
  ip address 8.8.4.4 255.255.255.255
exit

!# Default Route (opcional si usas default-route en el otro router)
ip route 0.0.0.0 0.0.0.0 123.2.2.2

end
write memory

!
!


````

## üï∏Ô∏è `MPLS-1` - (ACTIVE MPLS Circuit)


````py
!################
!# MPLS-1 (IOS) #
!################

!# Namings
enable
configure terminal
hostname MPLS-1

interface Ethernet0/0
   no shutdown
   description ** Link-MPLS-1 (RT-1) **
   ip address 10.100.0.1 255.255.255.252
   duplex full

!
interface Loopback0
 description ** Simulated Remote Net A **
 ip address 10.200.0.100 255.255.255.255
!
interface Loopback1
 description ** Simulated Remote Net B **
 ip address 10.210.0.100 255.255.255.255
!

# LANS & Backbone
ip route 192.168.10.0 255.255.255.0 10.100.0.2
ip route 192.168.20.0 255.255.255.0 10.100.0.2
ip route 192.168.30.0 255.255.255.0 10.100.0.2
ip route 10.0.0.0 255.0.0.0 10.100.0.2


end
write memory

!
!


````

## üï∏Ô∏è `MPLS-2` - (STAND-BY MPLS Circuit)

````py
!################
!# MPLS-2 (IOS) #
!################

!# Namings
enable
configure terminal
hostname MPLS-2

interface Ethernet0/0
   no shutdown
   description ** Link-MPLS-1 (RT-1) **
   ip address 10.100.0.5 255.255.255.252
   duplex full

!
interface Loopback0
 description ** Simulated Remote Net A **
 ip address 10.200.0.100 255.255.255.255
!
interface Loopback1
 description ** Simulated Remote Net B **
 ip address 10.210.0.100 255.255.255.255
!

# LANS & Backbone
ip route 192.168.10.0 255.255.255.0 10.100.0.6
ip route 192.168.20.0 255.255.255.0 10.100.0.6
ip route 192.168.30.0 255.255.255.0 10.100.0.6
ip route 10.0.0.0 255.0.0.0 10.100.0.6


end
write memory

!
!


````




# üóÉÔ∏è Resources

- https://www.youtube.com/watch?v=lADK3STwwAM&list=PLwAU7bA502wFB5j6RnpDPNG5xwb5JEbq8
- https://www.youtube.com/watch?v=fdc912ReAE4
- https://youtu.be/oBJNkFhPpfU?si=BpyN82rV99dBf_cI
- https://youtu.be/aPzNzvyv20A?si=1QMckKT0AjZHR1bm
- https://youtu.be/ieZkA7Ayc-4?si=XgsEx2Pz87hLBZM5
- https://youtu.be/IFb-Ncj5w-E?si=BsXcc9WlyG-W0vpu
- https://journey2theccie.wordpress.com/2020/07/20/hsrp-aware-dhcp-relay/

---

<span align="center"> <p align="center"> ![giphy](https://user-images.githubusercontent.com/94720207/166587250-292d9a9f-e590-4c25-a678-d457e2268e85.gif) </p> </span> 

&nbsp;

<span align="center"> <p align="center"> _I hope this information was useful for someone_ </p> </span> 
<span align="center"> <p align="center"> _and please, don't forget to enjoy your days..._ </p> </span> 
<span align="center"> <p align="center"> _...It is getting dark... so dark..._ </p> </span> 

&nbsp;

<span align="center"> <p align="center"> _In the mist of the night you could see me come, where shadows move and Demons lie..._ </p> </span> 
<span align="center"> <p align="center"> _I am [Fz3r0 üíÄ](https://github.com/Fz3r0/) and the Sun no longer rises..._ </p> </span> 

---

---

> ![hecho en mexico 5](https://user-images.githubusercontent.com/94720207/166068790-fa1f243d-2db9-4810-a6e4-eb3c4ad23700.png)
>
> _- Hecho en M√©xico - by [Fz3r0 üíÄ](https://github.com/Fz3r0/)_  
>
> _"In the mist of the night you could see me come, where shadows move and Demons lie..."_ 
