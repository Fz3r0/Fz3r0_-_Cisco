# üß†üèóÔ∏èüåê Cisco Nexus: `NX-OS - Tier 3 Fabric PT1 : OSPF Overlay + Essential Configs`

![My Video](https://user-images.githubusercontent.com/94720207/165892585-b830998d-d7c5-43b4-a3ad-f71a07b9077e.gif)

### üê¶ Twitter  : [@fz3r0_OPs](https://twitter.com/Fz3r0_OPs)
### üê± Github  : [Fz3r0](https://github.com/fz3r0) 

---
 
#### Keywords: `Cisco` `CCNA` `CCNP` `Datacenter` `NX-OS` `Cisco Nexus` `Leaf & Spine` `DC Switching` `Modular Chassis` `Fixed Form Factor` `vPC` `ECMP` `FEX` `Fabric Extender` `Nexus 2000` `Nexus 5000` `Nexus 7000` `Nexus 9000`  `Port-Channel` `LAG` `VLAN` `VRF` `Overlay` `Underlay` `EVPN` `VXLAN`  `Spine Switch` `Leaf Switch` `Control Plane` `Forwarding Plane` `Supervisor Card` `Line Card`  `Redundant Power Supply` `Hot-swappable` `In-Service Software Upgrade (ISSU)` `High Availability`  `Twinax Cable` `SFP+` `QSFP28` `QSFP-DD` `10G` `25G` `40G` `100G` `400G`

---

<br>

# üìÑ `Index`



[**üóÉÔ∏è Resources**](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/01-F0-Nexus_DC-CollapsedCore-HA.md#%EF%B8%8F-resources)

# üèóÔ∏è Cisco Nexus :: `NX-OS - Tier 3 Fabric PT1 : OSPF Overlay + Essential Configs`



## üéØ Objectives, Features & Protocols Covered



## üé• Lab Proof of Concept (PoC) - Video

- [**üëâ Click here to go to the PoC video üëà**](https://youtu.be/RL9hBT0H7UE)

## üó∫Ô∏è Network Topology

![image](https://github.com/user-attachments/assets/a0c47369-0548-4d4d-9c33-5ff1ba4a909c)


![image](https://github.com/user-attachments/assets/e00d954b-25fb-42f9-8d57-039aac10b8de)




## üìã Network Device Inventory & IP Addressing



## üìù Lab Notes

Credentials:

- Admin: `admin`
- Pass: `Adm1n.C1sc0`

Notes:

- During Nexus Switches start-up, select `skip` during "Abort Power On Auto Provisioning (yes - continue with normal setup, skip - bypass password and basic configuration, no - continue with Power On Auto Provisioning) (yes/skip/no)[no]: `skip`"
- The NX9-1 and NX9-2 must be powered on and configured before the edge routers, otherwise OSPF process 1 could bug/error.
- Check that all virtual NX devices are powered on and have no CLI issues; sometimes they can hang or freeze when too many sessions are open or multiple processes are running.

# **‚öôÔ∏è Devices Configurations**

- Copy & Paste the configuration in each device CLI

## ü•á `NX9-1-CR-ACT` - (Switch NX9-1 - CORE: ACTIVE HSRP (Priority 200))
























## üîÄ `vEDGE-1` - (Router 1 - SDWAN Edge) 

````py
!# Namings

enable
configure terminal
hostname vEDGE-1

!# Interfaces

#! L3 WAN INTERFACES @ CORE/LAN + OSPF FULL MESH

#! OSPF LINK - BEST PREFERENCE (1) @ SW-L3-MGMT-1
interface Ethernet0/0
   no shutdown
   duplex full
   description ** Link-to-SW-L3-MGMT-1 **
   ip address 100.1.1.1 255.255.255.252
   ip ospf network point-to-point
   ip ospf cost 1
   ip ospf hello-interval 1
   ip ospf dead-interval 4
   ip nat inside
exit

#! OSPF LINK - MEDIUM PREFERENCE (100) @ SW-L3-MGMT-2
interface Ethernet0/1
   no shutdown
   duplex full
   description ** Link-to-SW-L3-MGMT-2 **
   ip address 100.1.2.1 255.255.255.252
   ip ospf network point-to-point
   ip ospf cost 100
   ip ospf hello-interval 1
   ip ospf dead-interval 4
   ip nat inside
exit

#! OSPF LINK - WORST PREFERENCE (200) @ vEDGE-2 (WAN-2)
interface Ethernet0/2
   no shutdown
   duplex full
   description ** vEDGE1-vEDGE2-Edge-to-Edge-Link **
   ip address 100.1.5.1 255.255.255.252
   ip ospf network point-to-point
   ip ospf cost 200
   ip ospf hello-interval 1
   ip ospf dead-interval 4
   ip nat inside
exit

!# MPLS INTERFACE (Static Private Address) [Static Route @ MPLS-1]
interface Ethernet1/1
   no shutdown
   duplex full
   description ** Link-to-MPLS-1 **
   ip address 223.1.1.2 255.255.255.252
exit
!# MPLS STATIC ROUTES @ MPLS CIRCUITS
ip route 10.200.0.100 255.255.255.255 223.1.1.1
ip route 10.210.0.100 255.255.255.255 223.1.1.1



ip route 10.200.0.100 255.255.255.255 100.1.5.2 250
ip route 10.210.0.100 255.255.255.255 100.1.5.2 250

|# Deja s√≥lo una ruta est√°tica a 0.0.0.0 0.0.0.0 en cada vEdge, con distinto valor de distancia administrativa (AD) (menor = preferencia).
ip route 0.0.0.0 0.0.0.0 123.1.1.1 10
ip route 0.0.0.0 0.0.0.0 100.1.5.2 20




!# WAN INTERFACE (NAT OUTSIDE) [Default Route @ Internet]
interface Ethernet1/0
   no shutdown
   duplex full
   description ** Link-to-WAN-1_INTERNET **
   ip address 123.1.1.2 255.255.255.252
   ip nat outside
exit
!# Ruta por defecto hacia la nube Google
!ip route 0.0.0.0 0.0.0.0 123.1.1.1

!# NAT Inside/Outside ACL 10 (WAN-Internet)

!# OSPF Backbone
access-list 10 permit 100.1.1.0 0.0.0.3
access-list 10 permit 100.1.2.0 0.0.0.3
access-list 10 permit 100.1.3.0 0.0.0.3
access-list 10 permit 100.1.4.0 0.0.0.3
access-list 10 permit 100.1.5.0 0.0.0.3
access-list 10 permit 100.1.6.0 0.0.0.3

!# LAN/VLANs
access-list 10 permit 10.10.0.0 0.0.255.255
access-list 10 permit 10.20.0.0 0.0.255.255
access-list 10 permit 10.30.0.0 0.0.255.255

!# Overload all matching inside traffic to the WAN interface address
ip nat inside source list 10 interface Ethernet1/0 overload

!# OSPF Area 0 : Anuncia las redes LAN y P2P
router ospf 1

    !# Router ID (OSPF)
    router-id 1.1.1.1

    !# OSPF Network Devices links:

    !# enlace hacia NX9-1
    network 100.1.1.0 0.0.0.3 area 0
    !# enlace hacia NX9-2
    network 100.1.2.0 0.0.0.3 area 0
    !# enlace Edge-to-Edge
    network 100.1.5.0 0.0.0.3 area 0


    !# OSPF LAN-VLANs links:

    !# VLAN10       
    network 10.10.0.0 0.0.255.255 area 0
    !# VLAN20  
    network 10.20.0.0 0.0.255.255 area 0
    !# VLAN30
    network 10.30.0.0 0.0.255.255 area 0

    !# OSPF Edge links:

    !# RT1 - Outside WAN
    network 123.1.1.0 0.0.0.3 area 0

    !# RT2 - to MPLS (No NAT) (Network: 10.100.0.0)
    network 223.1.1.0 0.0.0.3 area 0

    !# Static (MPLS) & Default (WAN) propagation/redistribution

    !# propaga la ruta por defecto (WAN) 
    default-information originate always
    !# redistribuye las rutas est√°ticas (MPLS)
    redistribute static subnets

exit

end
write memory

!
!


````

## üîÄ `vEDGE-2` - (Router 2 - SDWAN Edge) 

````py
!# Namings

enable
configure terminal
hostname vEDGE-2

!# Interfaces

#! L3 WAN INTERFACES @ CORE/LAN + OSPF FULL MESH

#! OSPF LINK - BEST PREFERENCE (1) @ SW-L3-MGMT-2
interface Ethernet0/0
   no shutdown
   duplex full
   description ** Link-to-SW-L3-MGMT-2 **
   ip address 100.1.1.2 255.255.255.252
   ip ospf network point-to-point
   ip ospf cost 1
   ip ospf hello-interval 1
   ip ospf dead-interval 4
   ip nat inside
exit

#! OSPF LINK - MEDIUM PREFERENCE (100) @ SW-L3-MGMT-1
interface Ethernet0/1
   no shutdown
   duplex full
   description ** Link-to-SW-L3-MGMT-1 **
   ip address 100.1.2.2 255.255.255.252
   ip ospf network point-to-point
   ip ospf cost 100
   ip ospf hello-interval 1
   ip ospf dead-interval 4
   ip nat inside
exit

#! OSPF LINK - WORST PREFERENCE (200) @ vEDGE-1 (WAN-1)
interface Ethernet0/2
   no shutdown
   duplex full
   description ** vEDGE1-vEDGE2-Edge-to-Edge-Link **
   ip address 100.1.5.2 255.255.255.252
   ip ospf network point-to-point
   ip ospf cost 200
   ip ospf hello-interval 1
   ip ospf dead-interval 4
   ip nat inside
exit

!# MPLS INTERFACE (Static Private Address) [Static Route @ MPLS-2]
interface Ethernet1/1
   no shutdown
   duplex full
   description ** Link-to-MPLS-2 **
   ip address 223.2.2.2 255.255.255.252
exit
!# MPLS STATIC ROUTES @ MPLS CIRCUITS
ip route 10.200.0.100 255.255.255.255 223.2.2.1
ip route 10.210.0.100 255.255.255.255 223.2.2.1



ip route 10.200.0.100 255.255.255.255 100.1.5.1 250
ip route 10.210.0.100 255.255.255.255 100.1.5.1 250

|# Deja s√≥lo una ruta est√°tica a 0.0.0.0 0.0.0.0 en cada vEdge, con distinto valor de distancia administrativa (AD) (menor = preferencia).
ip route 0.0.0.0 0.0.0.0 123.2.2.1 10
ip route 0.0.0.0 0.0.0.0 100.1.5.1 20



!# WAN INTERFACE (NAT OUTSIDE) [Default Route @ Internet]
interface Ethernet1/0
   no shutdown
   duplex full
   description ** Link-to-WAN-1_INTERNET **
   ip address 123.2.2.2 255.255.255.252
   ip nat outside
exit
!# Ruta por defecto hacia la nube Google
!ip route 0.0.0.0 0.0.0.0 123.2.2.1

!# NAT Inside/Outside ACL 10 (WAN-Internet)

!# OSPF Backbone
access-list 10 permit 100.1.1.0 0.0.0.3
access-list 10 permit 100.1.2.0 0.0.0.3
access-list 10 permit 100.1.3.0 0.0.0.3
access-list 10 permit 100.1.4.0 0.0.0.3
access-list 10 permit 100.1.5.0 0.0.0.3
access-list 10 permit 100.1.6.0 0.0.0.3


!# LAN/VLANs
access-list 10 permit 10.10.0.0 0.0.255.255
access-list 10 permit 10.20.0.0 0.0.255.255
access-list 10 permit 10.30.0.0 0.0.255.255

!# Overload all matching inside traffic to the WAN interface address
ip nat inside source list 10 interface Ethernet1/0 overload

!# OSPF Area 0 : Anuncia las redes LAN y P2P
router ospf 1

    !# Router ID (OSPF)
    router-id 2.2.2.2

    !# OSPF Network Devices links:

    !# enlace hacia NX9-2
    network 100.1.4.0 0.0.0.3 area 0
    !# enlace hacia NX9-1
    network 100.1.3.0 0.0.0.3 area 0
    !# enlace Edge-to-Edge
    network 100.1.5.0 0.0.0.3 area 0


    !# OSPF LAN-VLANs links:

    !# VLAN10       
    network 10.10.0.0 0.0.255.255 area 0
    !# VLAN20  
    network 10.20.0.0 0.0.255.255 area 0
    !# VLAN30
    network 10.30.0.0 0.0.255.255 area 0

    !# OSPF Edge links:

    !# RT1 - Outside WAN
    network 123.2.2.0 0.0.0.3 area 0

    !# RT2 - to MPLS (No NAT) (Network: 10.100.0.0)
    network 223.2.2.0 0.0.0.3 area 0

    !# Static (MPLS) & Default (WAN) propagation/redistribution

    !# propaga la ruta por defecto (WAN) 
    default-information originate always
    !# redistribuye las rutas est√°ticas (MPLS)
    redistribute static subnets

exit

end
write memory

!
!


````










## üåé `WAN-1` - (ACTIVE Internet Circuit)

````py
!###############
!# WAN-1 (IOS) #
!###############

!# Namings
enable
configure terminal
hostname WAN-1

!# WAN Interface @ vEdge-1
interface Ethernet0/0
  no shutdown
  duplex full  
  description ** LINK-TO-vEDGE-1 **
  ip address 123.1.1.1 255.255.255.252
exit

!# Internet Interface
interface Ethernet0/1
  no shutdown
  duplex full  
  description ** LINK-TO-INTERNET-A **
  ip address 123.3.3.2 255.255.255.252
exit

!# Rutas estaticas para alcanzar los destinos del router INTERNET (Loopbacks)
ip route 8.8.8.8 255.255.255.255 123.3.3.1
ip route 8.8.4.4 255.255.255.255 123.3.3.1
ip route 1.1.1.1 255.255.255.255 123.3.3.1
ip route 1.0.0.1 255.255.255.255 123.3.3.1

!# Default Route para alcanzar vEdge-1
! ip route 0.0.0.0 0.0.0.0 123.1.1.2

end
write memory

!
!


````


## üåé `WAN-2` - (STAND-BY Internet Circuit)



````py
!###############
!# WAN-2 (IOS) #
!###############

!# Namings
enable
configure terminal
hostname WAN-2

!# WAN Interface @ vEdge-2
interface Ethernet0/0
  no shutdown
  duplex full
  description ** LINK-TO-vEDGE-2 **
  ip address 123.2.2.1 255.255.255.252
exit

!# Internet Interface
interface Ethernet0/1
  no shutdown
  duplex full  
  description ** LINK-TO-INTERNET-B **
  ip address 123.4.4.2 255.255.255.252
exit

!# Rutas para alcanzar los destinos del router INTERNET (Loopbacks)
ip route 8.8.8.8 255.255.255.255 123.4.4.1
ip route 8.8.4.4 255.255.255.255 123.4.4.1
ip route 1.1.1.1 255.255.255.255 123.4.4.1
ip route 1.0.0.1 255.255.255.255 123.4.4.1

!# Default Route para alcanzar vEdge-1
! ip route 0.0.0.0 0.0.0.0 123.2.2.2

end
write memory

!
!


````


## üåé `INTERNET` - (Internet Circuit Simulation)



````py
!#############
 !# INTERNET #
!#############

!# Namings
enable
configure terminal
hostname INTERNET

!# WAN Interface @ WAN1
interface Ethernet0/0
  no shutdown
  duplex full
  description ** LINK-TO-WAN-1 **
  ip address 123.3.3.1 255.255.255.252
exit
! Tr√°fico de retorno para WAN-1
ip route 123.3.3.0 255.255.255.252 123.3.3.2

!# WAN Interface @ WAN2
interface Ethernet0/1
  no shutdown
  duplex full  
  description ** LINK-TO-WAN-2 **
  ip address 123.4.4.1 255.255.255.252
exit
! Tr√°fico de retorno para WAN-2
ip route 123.4.4.0 255.255.255.252 123.4.4.2

! Retorno hacia WAN-1
ip route 123.3.3.2 255.255.255.255 123.3.3.2

! Retorno hacia WAN-2
ip route 123.4.4.2 255.255.255.255 123.4.4.2

! # Simula rutas de retorno del ISP hacia las IPs NATeadas por vEdge-1 y vEdge-2
ip route 123.1.1.2 255.255.255.255 123.3.3.2
ip route 123.2.2.2 255.255.255.255 123.4.4.2

!# Loopbacks (Google)

interface Loopback0
  description ** GOOGLE-DNS-1 **
  ip address 8.8.8.8 255.255.255.255
exit
interface Loopback1
  description ** GOOGLE-DNS-2 **
  ip address 8.8.4.4 255.255.255.255
exit

!# Loopbacks (Cloudflare)

interface Loopback2
  description ** CLOUDFLARE-DNS-1 **
  ip address 1.1.1.1 255.255.255.255
exit
interface Loopback3
  description ** CLOUDFLARE-DNS-2 **
  ip address 1.0.0.1 255.255.255.255
exit

! # Habilita el reenv√≠o de paquetes IP entre interfaces, necesario para que el router act√∫e como un verdadero router y no solo como un host con m√∫ltiples interfaces.
ip routing

end
write memory

!
!


````





## üï∏Ô∏è `MPLS-1` - (ACTIVE MPLS Circuit)


````py
!################
!# MPLS-1 (IOS) #
!################

!# Namings
enable
configure terminal
hostname MPLS-1

interface Ethernet0/0
   no shutdown
   description ** Link-to-vEdge-1 **
   ip address 223.1.1.1 255.255.255.252
   duplex full

interface Ethernet0/1
   no shutdown
   description ** Link-to-MPLS-Network **
   ip address 223.3.3.2 255.255.255.252
   duplex full



# LANS & Backbone
ip route 10.10.0.0 255.255.0.0 223.1.1.2
ip route 10.20.0.0 255.255.0.0 223.1.1.2
ip route 10.30.0.0 255.255.0.0 223.1.1.2

ip route 100.1.0.0 255.255.0.0 223.1.1.2

ip route 100.1.2.0 255.255.255.0 223.1.1.2

end
write memory

!
!


````

## üï∏Ô∏è `MPLS-2` - (STAND-BY MPLS Circuit)

````py
!################
!# MPLS-2 (IOS) #
!################

!# Namings
enable
configure terminal
hostname MPLS-2

interface Ethernet0/0
   no shutdown
   description ** Link-MPLS-2 **
   ip address 223.2.2.1 255.255.255.252
   duplex full

interface Ethernet0/1
   no shutdown
   description ** Link-to-MPLS-Network **
   ip address 223.4.4.2 255.255.255.252
   duplex full


# LANS & Backbone
ip route 10.10.0.0 255.255.0.0 223.2.2.2
ip route 10.20.0.0 255.255.0.0 223.2.2.2
ip route 10.30.0.0 255.255.0.0 223.2.2.2

ip route 100.1.0.0 255.255.0.0 223.2.2.2

ip route 100.1.1.0 255.255.255.0 223.2.2.2

end
write memory

!
!


````











!
interface Loopback0
 description ** Simulated Remote Net A **
 ip address 10.200.0.100 255.255.255.255
!
interface Loopback1
 description ** Simulated Remote Net B **
 ip address 10.210.0.100 255.255.255.255
!






# üóÉÔ∏è Resources

- https://www.youtube.com/watch?v=lADK3STwwAM&list=PLwAU7bA502wFB5j6RnpDPNG5xwb5JEbq8
- https://www.youtube.com/watch?v=fdc912ReAE4
- https://youtu.be/oBJNkFhPpfU?si=BpyN82rV99dBf_cI
- https://youtu.be/aPzNzvyv20A?si=1QMckKT0AjZHR1bm
- https://youtu.be/ieZkA7Ayc-4?si=XgsEx2Pz87hLBZM5
- https://youtu.be/IFb-Ncj5w-E?si=BsXcc9WlyG-W0vpu
- https://journey2theccie.wordpress.com/2020/07/20/hsrp-aware-dhcp-relay/

---

<span align="center"> <p align="center"> ![giphy](https://user-images.githubusercontent.com/94720207/166587250-292d9a9f-e590-4c25-a678-d457e2268e85.gif) </p> </span> 

&nbsp;

<span align="center"> <p align="center"> _I hope this information was useful for someone_ </p> </span> 
<span align="center"> <p align="center"> _and please, don't forget to enjoy your days..._ </p> </span> 
<span align="center"> <p align="center"> _...It is getting dark... so dark..._ </p> </span> 

&nbsp;

<span align="center"> <p align="center"> _In the mist of the night you could see me come, where shadows move and Demons lie..._ </p> </span> 
<span align="center"> <p align="center"> _I am [Fz3r0 üíÄ](https://github.com/Fz3r0/) and the Sun no longer rises..._ </p> </span> 

---

---

> ![hecho en mexico 5](https://user-images.githubusercontent.com/94720207/166068790-fa1f243d-2db9-4810-a6e4-eb3c4ad23700.png)
>
> _- Hecho en M√©xico - by [Fz3r0 üíÄ](https://github.com/Fz3r0/)_  
>
> _"In the mist of the night you could see me come, where shadows move and Demons lie..."_ 
