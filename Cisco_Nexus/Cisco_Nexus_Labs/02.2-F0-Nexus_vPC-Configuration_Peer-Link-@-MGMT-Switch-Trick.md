# üß†üèóÔ∏èüåê Cisco Nexus:  `NX-OS - vPC Configuration + Peer-Link + MGMT-Switch`

![My Video](https://user-images.githubusercontent.com/94720207/165892585-b830998d-d7c5-43b4-a3ad-f71a07b9077e.gif)

### üê¶ Twitter  : [@fz3r0_OPs](https://twitter.com/Fz3r0_OPs)
### üê± Github  : [Fz3r0](https://github.com/fz3r0) 

---
 
#### Keywords: `Cisco` `CCNA` `CCNP` `Datacenter` `NX-OS` `Cisco Nexus` `Leaf & Spine` `DC Switching` `Modular Chassis` `Fixed Form Factor` `vPC` `ECMP` `FEX` `Fabric Extender` `Nexus 2000` `Nexus 5000` `Nexus 7000` `Nexus 9000`  `Port-Channel` `LAG` `VLAN` `VRF` `Overlay` `Underlay` `EVPN` `VXLAN`  `Spine Switch` `Leaf Switch` `Control Plane` `Forwarding Plane` `Supervisor Card` `Line Card`  `Redundant Power Supply` `Hot-swappable` `In-Service Software Upgrade (ISSU)` `High Availability`  `Twinax Cable` `SFP+` `QSFP28` `QSFP-DD` `10G` `25G` `40G` `100G` `400G`

---

<br>

# üìÑ `Index`

[**üèóÔ∏è Cisco Nexus :: `NX-OS - vPC Configuration`**](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#%EF%B8%8F-cisco-nexus--nx-os---vpc-configuration-1)
- [üéØ Objectives, Features & Protocols Covered](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#-objectives-features--protocols-covered)
- [üé• Lab Proof of Concept (PoC) - Video](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#-lab-proof-of-concept-poc---video)
- [üó∫Ô∏è Network Topology](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#%EF%B8%8F-network-topology)
- [üîÅ Key Differences: Lab v1 vs Lab v2]()
- [üìã Network Device Inventory & IP Addressing](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#-network-device-inventory--ip-addressing)
- [üìù Lab Notes](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#-lab-notes)

[**‚öôÔ∏è Devices Configurations**](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#%EF%B8%8F-devices-configurations) 
- [1Ô∏è‚É£‚öôÔ∏è vPC CONFIG STEP 1 :: `vPC Domain` + `Peer-Link` + `KeepAlive-Link` @ Switch-vPC-A & Switch-vPC-B](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#1%EF%B8%8F%E2%83%A3%EF%B8%8F-vpc-config-step-1--vpc-domain--peer-link--keepalive-link--switch-vpc-a--switch-vpc-b)
    - [ü•á `NX9-SWITCH-vPC-A` - (vPC-A)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#-nx9-switch-vpc-a---vpc-a)
    - [ü•à `NX9-SWITCH-vPC-B` - (vPC-B)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#-nx9-switch-vpc-b---vpc-b) 

- [2Ô∏è‚É£‚öôÔ∏è vPC CONFIG STEP 2 :: `Multi-chassis EtherChannel (MEC) AKA vPC Port Channels` @ vPC <<==>> Host (Trunk/SVI)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#2%EF%B8%8F%E2%83%A3%EF%B8%8F-vpc-config-step-2--vpc-port-channels--vpc--host-trunksvi)
    - [üîõ vPC CONFIG :: vPC <<==>> L3 SVI](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#-vpc-config--vpc--l3-svi) 
        - [ü•á `NX9-SWITCH-vPC-A` - (vPC-A)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#-nx9-switch-vpc-a---vpc-a-1)
        - [ü•à `NX9-SWITCH-vPC-B` - (vPC-B)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#-nx9-switch-vpc-b---vpc-b-1)
        - [üîÄ L3-SWITCH-3 - (Layer 2 Port Channel @ NXOS Switch L3 SVI/TRUNK)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#-l3-switch-3---layer-2-port-channel--nxos-switch-l3-svitrunk)  <br><br>
    - [üîõ vPC CONFIG :: vPC <<==>> Switch L2](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#-vpc-config--vpc--switch-l2)
        - [ü•á `NX9-SWITCH-vPC-A` - (vPC-A)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#-nx9-switch-vpc-a---vpc-a-2)
        - [ü•à `NX9-SWITCH-vPC-B` - (vPC-B)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#-nx9-switch-vpc-b---vpc-b-2) 
        - [‚ÜîÔ∏è L2-SWITCH-2 - (Layer 2 Port Channel @ NXOS Switch L2 TRUNK)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#%EF%B8%8F-l2-switch-2---layer-2-port-channel--nxos-switch-l2-trunk)  <br><br>
    - [üñ•Ô∏è CONFIG :: Hosts (Servers)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#%EF%B8%8F-config--hosts-servers) 
        - [üñ•Ô∏è SERVER-1-V10-MGMT - (Server 1)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#%EF%B8%8F-server-1-v10-mgmt---server-1)
        - [üñ•Ô∏è SERVER-2-V10-MGMT - (Server 2)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#%EF%B8%8F-server-2-v10-mgmt---server-2)

[**‚ö†Ô∏è vPC / Port-Channel :: `Verification` & `Troubleshooting`**](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#%EF%B8%8F-vpc--port-channel--verification--troubleshooting)
- [‚úÖ vPC Core, Domain & Peer Status](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#-vpc-core-domain--peer-status)
- [‚úÖ Port-Channel (Po) Status & Interfaces](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#-port-channel-po-status--interfaces)
            
[**üóÉÔ∏è Resources**](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02-F0-Nexus_vPC-Configuration.md#%EF%B8%8F-resources)

# üèóÔ∏è Cisco Nexus :: `NX-OS - vPC Configuration`

In the previous lab (NX-OS - vPC Configuration)[https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/02.1-F0-Nexus_vPC-Configuration.md], we built a classic vPC topology where the peer-link between the two Nexus switches was a direct physical connection, and the `mgmt0` interfaces were used for the **keepalive link**. However, to enable switch management, we had to create a new VLAN 10 ("management") and assign an SVI on each Nexus switch. This meant that all management traffic traversed the same data network and shared the same fabric as regular switch traffic, which could become a security or architectural concern in larger environments.

**In this new version, we're taking the topology a step further by introducing a centralized `MGMT-SWITCH` that serves a dual purpose:**

1. **As an out-of-band management switch (aggregating all mgmt0 interfaces), and**

2. **As a shared aggregation point for the vPC peer-links.**

This new architecture provides multiple operational and scalability benefits. Instead of connecting the vPC peer-link directly between the Nexus switches, we route it through the MGMT-SWITCH. This allows all Nexus devices to share a single management VLAN for out-of-band access while simultaneously using the same switch as the transit path for their vPC peer-link traffic.

By completing this deployment, you'll be fully prepared to extend the fabric with advanced technologies like `VXLAN` and `EVPN`.

## üéØ Objectives, Features & Protocols Covered

In this lab, we‚Äôll maintain the same core configuration used in the previous setup:

- The **vPC domain 666** across NX9-SWITCH-vPC-A and NX9-SWITCH-vPC-B
- **Two port-channels**: Po1 connecting to the L3 Gateway, and Po2 to the L2 Access Switch
- Standard features like LACP, role priority, auto-recovery, and SVI-based routing

However, the key difference in this version is the **introduction of a centralized MGMT-SWITCH that fully separates management traffic both physically and logically:**

- `mgmt0` interfaces now connect to a **dedicated out-of-band switch**, operating on its **own management VLAN and VRF**.
- Meanwhile, VLAN 10-Blue is isolated and remains part of the main fabric for regular L2/L3 operations

This approach decouples the management network from the production fabric, allowing for cleaner separation, better security, and improved scalability‚Äîespecially in multi-device or multi-site environments.

## üé• Lab Proof of Concept (PoC) - Video

- [**üëâ Click here to go to the PoC video üëà**](https://youtu.be/RL9hBT0H7UE)

## üó∫Ô∏è Network Topology

<p align="center"> <img src="https://github.com/user-attachments/assets/28c86bec-7dea-4dc1-bc42-616903025dc3">  </p>

## üîÅ Key Differences: Lab v1 vs Lab v2

| Component               | **vPC Lab v1**                           | **vPC Lab v2 (with MGMT-SWITCH)**                     |
| ----------------------- | ---------------------------------------- | ----------------------------------------------------- |
| `Peer-Link`             | Direct physical connection between Nexus | Routed **through MGMT-SWITCH** via trunk ports        |
| `mgmt0 Interfaces`      | Point-to-point connection                | Connected to MGMT-SWITCH using **access VLAN**        |
| Management VLAN         | Shared, coexists with peer-link          | **Isolated VLAN** on dedicated switch                 |
| `VRF` Usage             | Usually `management` or `default`        | Explicit use of `VRF management` with full separation |
| Cable/Port Requirements | Higher (per device-to-device pair)       | Lower (just uplinks to MGMT-SWITCH)                   |
| Scalability             | Limited                                  | **Highly scalable** ‚Äî just plug into MGMT-SWITCH      |
| Role of MGMT-SWITCH     | None (not present)                       | Dual: **OOB management** + **Peer-Link hub**          |


## üìã Network Device Inventory & IP Addressing

| Device                                | Function          | Interface / VLAN         | IP / CIDR         | Gateway       | *Network*    | *Broadcast*    | Main Description                      |
| ------------------------------------- | ----------------- | ------------------------ | ----------------- | ------------- | ------------ | -------------- | ------------------------------------- |
| **`NX9-SWITCH-vPC-A`**<br>(NXOS)      | vPC Core Peer A   | VLAN 10 (SVI)            | `10.10.10.11/24`  | `10.10.10.1`  | *10.10.10.0* | *10.10.10.255* | Management SVI ‚Äì Peer A               |
|                                       |                   | Po1 (Eth1/1)             | trunk VLAN 10     | ‚Äì             | ‚Äì            | ‚Äì              | L2 Po to L3-SWITCH-3                  |
|                                       |                   | Po2 (Eth1/2)             | trunk VLAN 10     | ‚Äì             | ‚Äì            | ‚Äì              | L2 Po to L2-SWITCH-2                  |
|                                       |                   | Po100 (Eth1/6-7)         | trunk VLAN ALL    | ‚Äì             | ‚Äì            | ‚Äì              | vPC Peer-Link                         |
|                                       |                   | mgmt0 (Keepalive)        | `10.10.68.1/24`   | `10.10.68.2`  | *10.10.68.0* | *10.10.68.255* | vPC Keepalive (VRF: management)       |
| **`NX9-SWITCH-vPC-B`**<br>(NXOS)      | vPC Core Peer B   | VLAN 10 (SVI)            | `10.10.10.12/24`  | `10.10.10.1`  | *10.10.10.0* | *10.10.10.255* | Management SVI ‚Äì Peer B               |
|                                       |                   | Po1 (Eth1/1)             | trunk VLAN 10     | ‚Äì             | ‚Äì            | ‚Äì              | L2 Po to L3-SWITCH-3                  |
|                                       |                   | Po2 (Eth1/2)             | trunk VLAN 10     | ‚Äì             | ‚Äì            | ‚Äì              | L2 Po to L2-SWITCH-2                  |
|                                       |                   | Po100 (Eth1/6-7)         | trunk VLAN ALL    | ‚Äì             | ‚Äì            | ‚Äì              | vPC Peer-Link                         |
|                                       |                   | mgmt0 (Keepalive)        | `10.10.68.2/24`   | `10.10.68.1`  | *10.10.68.0* | *10.10.68.255* | vPC Keepalive (VRF: management)       |
| **`L3-SWITCH-3`**<br>(NXOS)           | L3 Gateway Switch | VLAN 10 (SVI)            | `10.10.10.1/24`   | ‚Äì             | *10.10.10.0* | *10.10.10.255* | Default Gateway for VLAN 10           |
|                                       |                   | Po1 (Eth1/1-2)           | trunk VLAN 10     | ‚Äì             | ‚Äì            | ‚Äì              | Uplink Po to vPC Peers (Po1 on both)  |
|                                       |                   | Eth1/7 (Access)          | access VLAN 10    | ‚Äì             | ‚Äì            | ‚Äì              | Access port to SERVER-1               |
| **`L2-SWITCH-2`**<br>(NXOS)           | L2 Access Switch  | VLAN 10 (SVI ‚Äì optional) | `10.10.10.13/24`  | `10.10.10.1`  | *10.10.10.0* | *10.10.10.255* | Management SVI (optional)             |
|                                       |                   | Po2 (Eth1/1-2)           | trunk VLAN 10     | ‚Äì             | ‚Äì            | ‚Äì              | Uplink Po to vPC Peers (Po2 on both)  |
|                                       |                   | Eth1/7 (Access)          | access VLAN 10    | ‚Äì             | ‚Äì            | ‚Äì              | Access port to SERVER-2               |
| **`SERVER-1-V10-MGMT`**<br>(IOS Host) | Simulated Host    | Eth0                     | `10.10.10.101/24` | `10.10.10.1`  | *10.10.10.0* | *10.10.10.255* | End-host in VLAN 10 (via L3-SWITCH-3) |
| **`SERVER-2-V10-MGMT`**<br>(IOS Host) | Simulated Host    | Eth0                     | `10.10.10.102/24` | `10.10.10.1`  | *10.10.10.0* | *10.10.10.255* | End-host in VLAN 10 (via L2-SWITCH-2) |

## üìù Lab Notes

Credentials:

- Admin: `admin`
- Pass: `admin.cisco`

Notes:

- During Nexus Switches start-up, select `skip` during "Abort Power On Auto Provisioning (yes - continue with normal setup, skip - bypass password and basic configuration, no - continue with Power On Auto Provisioning) (yes/skip/no)[no]: `skip`"
- During Nexus Switches start-up, sometimes the boot process hangs after executing the kick start, when it tries to load the operating system and drops a `loader>` prompt. In that case, type `dir`, locate the operating system filename (e.g. `nxos64.10.1.1.bin`) and manually run the command `boot nxos64.10.1.1.bin`, which will load the OS. _(You can also wipe the device and reboot it.)_
- Check that all virtual NX devices are powered on and have no CLI issues; sometimes they can hang or freeze when too many sessions are open or multiple processes are running.
- I tried to reduce LACP timers to do the tests fasters, but it seems that in this version of NXOS is not possible. 

# **‚öôÔ∏è Devices Configurations**

To fully deploy a vPC setup, there are two key configuration steps:

- 1Ô∏è‚É£ `Step 1` ‚Äì **Core vPC Setup**: This is the foundational step where you configure two Nexus switches (vPC-A and vPC-B) to act as a single logical switch to downstream devices:
- 2Ô∏è‚É£ `Step 2` ‚Äì **Connecting External Devices via vPC Port-Channels**: Now that the vPC core is active, this step is about connecting downstream switches or hosts using vPC-backed Port-Channels:

_(Copy & Paste the configuration in each device CLI)_

## 1Ô∏è‚É£‚öôÔ∏è vPC CONFIG STEP 1 :: `vPC Domain` + `Peer-Link` + `KeepAlive-Link` @ `Switch-vPC-A & Switch-vPC-B`

This is the foundational step in building a vPC environment. 

- You‚Äôre configuring the logical **vPC domain (Domain 666) between your two Nexus switches so they can act as one virtual switch to downstream devices**.

Once this is in place, both Nexus switches are ready to support multi-chassis port-channels, and you can proceed to **Step 2**, where downstream switches or hosts are connected to the vPC fabric using `vpc <id>` assignments on new `port-channels`.

‚úÖ Mandatory configs that make vPC possible:

- `feature`: vpc	and lacp features must be enabled (For VPC and Port-Channel config)
- `vpc domain <id>`:	Logical group ID that binds both switches into a vPC pair
- `Peer-Link`:	L2 trunk that carries vPC state, control traffic, and data
- `Keepalive-Link`:	L3 link to ensure both switches can detect each other‚Äôs health

üß© Optional configs (But Recommended):

- `role priority`:	Determines which switch becomes the vPC primary (lower wins)
- `auto-recovery`:	Allows a switch to come back up in split-brain scenarios
- `system-priority`:	Affects LACP system negotiation (keep consistent across peers)
- `SVI Gateway & ip route 0.0.0.0`: Basic default route for management plane connectivity & testing purposes



# Devices Config

This senction includes the configuration of the 4 nexus switches and the management switch bal bla bla. ....

## ü•á `NX9-SWITCH-vPC-A` - (vPC-A)

````py
!##################################################
!#    NEXUS - NX9-SWITCH-vPC-A                    #
!#    ROLE  - VPC-A                               #
!#    MGMT* - 10.10.66.11/24                      #
!#    BLUE  - 10.10.10.11/24                      #
!#    LOGIN - admin / admin.cisco                 #
!##################################################

!# NAMINGS, USERS, LICENCES, DISCOVERY
configure terminal
hostname NX9-SWITCH-vPC-A
username admin password admin.cisco
cdp enable

#! SVIs + DEFAULT GATEWAY (HSRP CORES)
feature interface-vlan
vlan 10
   name VLAN10-BLUE
interface vlan 10
   no shutdown
   description ** SVI-L3-VLAN10-BLUE **
   ip address 10.10.10.11/24 
exit
!# ip default-gateway 10.10.10.1 <- This command is deprecated.
ip route 0.0.0.0/0 10.10.10.1

!# =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

!# << vPC Configuration - vPC Domain 666 >> 

!# << vPC STEP1 - FEATURES >>

feature vpc
feature lacp

!# << vPC STEP2 - MGMT INTERFACE CONFIG >> <<=== MANAGEMENT OUT OF BAND + PEER-LINK

!# Add DNS and Default Gateway to MGMT VLAN/VRF
vrf context management
  ip name-server 8.8.8.8 8.8.4.4
  ip route 0.0.0.0/0 10.10.66.1
!# Configure mgmt0 interface
interface mgmt 0
   description ** MGMT INTERFACE + vPC PEER-LINK **
   no shutdown
   vrf member management
   ip address 10.10.66.11/24
exit

!# << vPC STEP 3 - vPC Domain CONFIG >>

vpc domain 666
  peer-keepalive destination 10.10.66.12 source 10.10.66.11 vrf management
  role priority 100              
  auto-recovery                  
  system-priority 1000             
exit

!# << vPC STEP 4 - vPC PEER-LINK INTERFACE >>

!# - 3.2: Interfaces used for Peer-Link (LACP trunk)
interface ethernet 1/6-7
  description ** vPC Peer-Link to Peer **
  channel-group 100 mode active
  no shutdown
exit

!# << vPC STEP 5 - PORT CHANNEL INTERFACE (For Peer-Link) >>

interface port-channel 100
  description ** vPC Peer-Link **
  no shutdown
  switchport
  switchport mode trunk  
  vpc peer-link     
exit

!# =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

!# << vPC - PORT CHANNELS CONFIGURATIONS @ Hosts>> 

!# << Port Channel : NX9-SWITCH-vPC-A -->> L3-SWITCH-3

!# Set interface used for Host Port-Channel 1 = eth 1/1
interface ethernet 1/1
  description ** Po1 - Host Port Channel  **
  channel-group 1 mode active
  no shutdown
exit
!# Configure Port-Channel 1 on = eth 1/1
interface port-channel 1
  description ** Po1 - Host Port Channel  **
  no shutdown
  switchport
  switchport mode trunk
  duplex full
  vpc 1
exit

!# << Port Channel : NX9-SWITCH-vPC-A -->> L2-SWITCH-2

!# Set interface used for Host Port-Channel 2 = eth 1/2
interface ethernet 1/2
  description ** Po2 - Host Port Channel  **
  channel-group 2 mode active
  no shutdown
exit
!# Configure Port-Channel 2 on = eth 1/2
interface port-channel 2
  description ** Po2 - Host Port Channel  **
  no shutdown
  switchport
  switchport mode trunk
  vpc 2
exit

!# << MOTD & CREDITS>> 

banner motd $

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

                         -- Fz3r0 : Nexus Datacenter --

+ DEVICE    =  NX9-SWITCH-vPC-A
+ MGMT*     =  10.10.66.11
+ BLUE      =  10.10.10.11

? LOGIN     =  admin / admin.cisco    

* Github : Fz3r0           
* Twitter: @fz3r0_OPs 
* Youtube: @fz3r0_OPs

$

!# SAVE CHECKPOINT & CONFIGURATION

end
checkpoint fz3r0-check-2025-NX9-vPC-A
copy running-config startup-config

!
!


````

## ü•à `NX9-SWITCH-vPC-B` - (vPC-B)

````py
!##################################################
!#    NEXUS - NX9-SWITCH-vPC-B                    #
!#    ROLE  - VPC-B                               #
!#    MGMT* - 10.10.66.12/24                      #
!#    BLUE  - 10.10.10.12/24                      #
!#    LOGIN - admin / admin.cisco                 #
!##################################################

!# NAMINGS, USERS, LICENCES, DISCOVERY
configure terminal
hostname NX9-SWITCH-vPC-B
username admin password admin.cisco
cdp enable

#! SVIs (MANAGEMENT) + DEFAULT GATEWAY (HSRP CORES)
feature interface-vlan
vlan 10
   name  VLAN10-BLUE
interface vlan 10
   no shutdown
   description ** SVI-L3-VLAN10-BLUE **
   ip address 10.10.10.12/24 
exit
!# ip default-gateway 10.10.10.1 <- This command is deprecated.
ip route 0.0.0.0/0 10.10.10.1

!# << vPC STEP1 - FEATURES >>

feature vpc
feature lacp

!# << vPC STEP2 - MGMT INTERFACE CONFIG >> <<=== MANAGEMENT OUT OF BAND + PEER-LINK

!# Add DNS and Default Gateway to MGMT VLAN/VRF
vrf context management
  ip name-server 8.8.8.8 8.8.4.4
  ip route 0.0.0.0/0 10.10.66.1
!# Configure mgmt0 interface
interface mgmt 0
   description ** MGMT INTERFACE + vPC PEER-LINK **
   no shutdown
   vrf member management
   ip address 10.10.66.12/24
exit

!# << vPC STEP 3 - vPC Domain CONFIG >>

vpc domain 666
  peer-keepalive destination 10.10.68.11 source 10.10.68.12 vrf management
  role priority 200              
  auto-recovery                  
  system-priority 1000             
exit

!# << vPC STEP 4 - vPC PEER-LINK INTERFACE >>

!# - 3.2: Interfaces used for Peer-Link (LACP trunk)
interface ethernet 1/6-7
  description ** vPC Peer-Link to Peer **
  channel-group 100 mode active
  no shutdown
exit

!# << vPC STEP 5 - PORT CHANNEL INTERFACE (For Peer-Link) >>

interface port-channel 100
  description ** vPC Peer-Link **
  no shutdown
  switchport
  switchport mode trunk    
  vpc peer-link     
exit

!# =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

!# << vPC - PORT CHANNELS CONFIGURATIONS @ Hosts>> 

!# << Port Channel : NX9-SWITCH-vPC-B -->> L3-SWITCH-3

!# Set interface used for Host Port-Channel 1 = eth 1/1
interface ethernet 1/1
  description ** Po1 - Host Port Channel  **
  channel-group 1 mode active
  no shutdown
exit
!# Configure Port-Channel 1 on = eth 1/1
interface port-channel 1
  description ** Po1 - Host Port Channel  **
  no shutdown
  switchport
  switchport mode trunk
  vpc 1
  duplex full
exit

!# << Port Channel : NX9-SWITCH-vPC-B -->> L2-SWITCH-2

!# Set interface used for Host Port-Channel 2 = eth 1/2
interface ethernet 1/2
  description ** Po2 - Host Port Channel  **
  channel-group 2 mode active
  no shutdown
exit
!# Configure Port-Channel 2 on = eth 1/2
interface port-channel 2
  description ** Po2 - Host Port Channel  **
  no shutdown
  switchport
  switchport mode trunk
  !# Po2 = VPC2
  vpc 2
exit



!# MOTD & CREDITS

banner motd $

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

                         -- Fz3r0 : Nexus Datacenter --

+ DEVICE    =  NX9-SWITCH-vPC-B
+ MGMT*     =  10.10.66.12
+ BLUE      =  10.10.10.12

? LOGIN     =  admin / admin.cisco    

* Github : Fz3r0           
* Twitter: @fz3r0_OPs 
* Youtube: @fz3r0_OPs

$

!# SAVE CHECKPOINT & CONFIGURATION

end
checkpoint fz3r0-check-2025-NX9-vPC-B
copy running-config startup-config

!
!


````

## üîÄ `L3-SWITCH-3` - (Layer 2 Port Channel @ NXOS Switch L3 SVI/TRUNK)

````py
!##################################################
!#    NEXUS - L3-SWITCH-3                         #
!#    ROLE  - HOST L3                             #
!#    MGMT* - 10.10.66.14/24                      #
!#    BLUE  - 10.10.10.1/24                       #
!#    LOGIN - admin / admin.cisco                 #
!##################################################

!# NAMINGS, USERS, LICENCES, DISCOVERY
configure terminal
hostname L3-SWITCH-3
username admin password admin.cisco
cdp enable

#! SVIs + DEFAULT GATEWAY (HSRP CORES)
feature interface-vlan
vlan 10
   name  VLAN10-BLUE
interface vlan 10
   no shutdown
   description ** SVI-L3-VLAN10-BLUE **
   ip address 10.10.10.1/24 
exit

!# << MANAGEMENT INTERFACE >>

!# Add DNS and Default Gateway to MGMT VLAN/VRF
vrf context management
  ip name-server 8.8.8.8 8.8.4.4
  ip route 0.0.0.0/0 10.10.66.1
!# Configure mgmt0 interface
interface mgmt 0
   description ** MGMT INTERFACE + vPC PEER-LINK **
   no shutdown
   vrf member management
   ip address 10.10.66.14/24
exit

!# << FEATURES >>

feature lacp

!# << Port Channel : L3-SWITCH-3 -->> NX9-SWITCH-vPC-A+B

!# Set interface used for Host Port-Channel 2 = eth 1/2
interface ethernet 1/1-2
  description ** Po1 - Host Port Channel  **
  channel-group 1 mode active
  no shutdown
exit

!# Configure Port-Channel 1 on = eth 1/2
interface port-channel 1
  description ** Po1 - Host Port Channel  **
  no shutdown
  switchport
  switchport mode trunk
exit

!# ACCESS INTERFACE TO HOST-A

!# Configure Access Interface @ Host-A - VLAN 10 mgmt
interface ethernet 1/7
  description ** Access Host A  **
  no shutdown
  switchport
  switchport mode access
  switchport access vlan 10
exit

!# MOTD & CREDITS

banner motd $

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

                         -- Fz3r0 : Nexus Datacenter --

+ DEVICE    =  L2-SWITCH-2
+ MGMT*     =  10.10.66.14
+ BLUE      =  10.10.10.1

? LOGIN     =  admin / admin.cisco    

* Github : Fz3r0           
* Twitter: @fz3r0_OPs 
* Youtube: @fz3r0_OPs

$

!# SAVE CHECKPOINT & CONFIGURATION

end
checkpoint fz3r0-check-2025-L3-SWITCH-3
copy running-config startup-config

!
!


````

## ‚ÜîÔ∏è `L2-SWITCH-2` - (Layer 2 Port Channel @ NXOS Switch L2 TRUNK)

````py
!##################################################
!#    NEXUS - L2-SWITCH-2                         #
!#    ROLE  - HOST L2                             #
!#    MGMT* - 10.10.66.13/24                      #
!#    BLUE  - 10.10.10.13/24                      #
!#    LOGIN - admin / admin.cisco                 #
!##################################################

!# NAMINGS, USERS, LICENCES, DISCOVERY
configure terminal
hostname L2-SWITCH-2
username admin password admin.cisco
cdp enable

#! SVIs + DEFAULT GATEWAY (HSRP CORES)
feature interface-vlan
vlan 10
   name  VLAN10-BLUE
interface vlan 10
   no shutdown
   description ** SVI-L3-VLAN10-BLUE **
   ip address 10.10.10.13/24 
exit
#! Default Gateway (Default VRF)
ip route 0.0.0.0/0 10.10.10.1

!# << MANAGEMENT INTERFACE >>

!# Add DNS and Default Gateway to MGMT VLAN/VRF
vrf context management
  ip name-server 8.8.8.8 8.8.4.4
  ip route 0.0.0.0/0 10.10.66.1
!# Configure mgmt0 interface
interface mgmt 0
   description ** MGMT INTERFACE + vPC PEER-LINK **
   no shutdown
   vrf member management
   ip address 10.10.66.14/24
exit

!# << FEATURES >>

feature lacp

!# << Port Channel : L2-SWITCH-2 -->> NX9-SWITCH-vPC-B

!# Set interface used for Host Port-Channel 2 = eth 1/2
interface ethernet 1/1-2
  description ** Po2 - Host Port Channel  **
  channel-group 2 mode active
  no shutdown
exit

!# Configure Port-Channel 2 on = eth 1/2
interface port-channel 2
  description ** Po2 - Host Port Channel  **
  no shutdown
  switchport
  switchport mode trunk
exit

!# ACCESS INTERFACE TO HOST-B

!# Configure Access Interface @ Host-B - VLAN 10 mgmt
interface ethernet 1/7
  description ** Access Host B  **
  no shutdown
  switchport
  switchport mode access
  switchport access vlan 10
exit

!# MOTD & CREDITS

banner motd $

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

                         -- Fz3r0 : Nexus Datacenter --

+ DEVICE    =  L2-SWITCH-2
+ MGMT*     =  10.10.66.13
+ BLUE      =  10.10.10.13

? LOGIN     =  admin / admin.cisco    

* Github : Fz3r0           
* Twitter: @fz3r0_OPs 
* Youtube: @fz3r0_OPs

$

!# SAVE CHECKPOINT & CONFIGURATION

end
checkpoint fz3r0-check-2025-L2-SWITCH-2
copy running-config startup-config

!
!


````

## üñ•Ô∏è `MGMW-SWITCH` - (IOS Management Switch / Management Gateway)

````py
! ###############
! # MGMT SWITCH #
! ###############

! # Enable & Config Exec Line
enable
configure terminal

! # Change the device hostname
hostname MGMT-SWITCH

! # Disable DNS lookup to avoid delays when typing invalid commands
no ip domain-lookup

! # IP Routing / router mode
ip routing

!# << VLAN & INTERFACE  CONFIGURATION >>

! # Create VLAN
vlan 66
    name V66-MGMT
exit

! # Configure interface as SVI to become Gateway
interface vlan 66
   description ** SVI Interface - MGMT Gateway **
   ip address 10.10.66.1 255.255.255.0
   no shutdown
exit

! # Configure Access Interface - ADMIN Fz3r0
interface ethernet 0/0
   description ** ACCESS - V66 - ADMIN Fz3r0 **
   duplex full
   no shutdown
   switchport mode access
   switchport access vlan 66
exit

! # Configure Access Interfaces - vPC Peer-Link & MGMT for Nexus Switches
interface range ethernet 1/0-3
   description ** ACCESS - V66 - NEXUS MGMT & PEER-LINK **
   duplex full
   no shutdown
   switchport mode access
   switchport access vlan 66
exit

! # Exit & Save
end
write memory


!
!


````

# üñ•Ô∏è CONFIG :: `Hosts` (Servers)

This section adds basic L3 endpoints (servers) to simulate north-south traffic flows through the fabric. These devices are not running any routing protocol, just a static IP and default route. They help verify:

- ‚úÖ End-to-end IP connectivity
- ‚úÖ vPC Port-Channel forwarding
- ‚úÖ SVI gateway reachability
- ‚úÖ LACP behavior during link failures

Each server is configured as a simple host with a static IP and default gateway (e.g. 10.10.10.1), representing real-world clients or services connected to your access layer.

_These configs are intentionally minimal, just enough to test pings, routing, and basic traffic across the vPC fabric._

## üñ•Ô∏è `SERVER-1-V10-MGMT` - (Server 1)

````py
! ############
! # SERVER-1 #
! ############

! # Enable & Config Exec Line
enable
configure terminal

! # Change the device hostname
hostname SERVER-1-V10-MGMT

! # Disable DNS lookup to avoid delays when typing invalid commands
no ip domain-lookup

! # Configure interface as if it's the PC's network card
interface Ethernet 0/0
   description ** Simulated PC Interface **
   ip address 10.10.10.101 255.255.255.0
   duplex full
   no shutdown
exit

! # Set a default route pointing to the gateway (usually your lab router)
ip route 0.0.0.0 0.0.0.0 10.10.10.1

! # Exit & Save
end
write memory


!
!


````

## üñ•Ô∏è `SERVER-2-V10-MGMT` - (Server 2)

````py
! ############
! # SERVER-2 #
! ############

! # Enable & Config Exec Line
enable
configure terminal

! # Change the device hostname
hostname SERVER-2-V10-MGMT

! # Disable DNS lookup to avoid delays when typing invalid commands
no ip domain-lookup

! # Configure interface as if it's the PC's network card
interface Ethernet 0/0
   description ** Simulated PC Interface **
   ip address 10.10.10.102 255.255.255.0
   duplex full
   no shutdown
exit

! # Set a default route pointing to the gateway (usually your lab router)
ip route 0.0.0.0 0.0.0.0 10.10.10.1

! # Exit & Save
end
write memory


!
!


````

## üíÄ `ADMIN-Fz3r0` - (Administrator)

````py
! ###############
! # ADMIN-Fz3r0 #
! ###############

! # Enable & Config Exec Line
enable
configure terminal

! # Change the device hostname
hostname ADMIN-Fz3r0

! # Disable DNS lookup to avoid delays when typing invalid commands
no ip domain-lookup

! # Configure interface as if it's the PC's network card
interface Ethernet 0/0
   description ** Simulated PC Interface **
   ip address 10.10.66.100 255.255.255.0
   duplex full
   no shutdown
exit

! # Set a default route pointing to the gateway (usually your lab router)
ip route 0.0.0.0 0.0.0.0 10.10.66.1

! # Exit & Save
end
write memory


!
!


````

# ‚ö†Ô∏è vPC / Port-Channel :: `Verification` & `Troubleshooting`

üí° Replace <id> with the relevant Port-Channel number (100 for peer-link, 1, 2, etc. for host Po), and <slot/port> with actual interface (e.g. ethernet 1/2).

## ‚úÖ vPC Core, Domain & Peer Status

````py
!# Overall vPC status and adjacency
show vpc                               

!# Role assignment: primary / secondary
show vpc role                          

!# Summary of all vPCs and port-channels
show vpc brief                         

!# Status of vPC keepalive link
show vpc peer-keepalive                

!# Global consistency checks
show vpc consistency-parameters global 

!# Per-vPC consistency
show vpc consistency-parameters interface port-channel <id>

!# Check mgmt0 interface IP and up/down
show ip interface brief vrf management          

!# Ping from vPC-A to vPC-B
ping 10.10.68.2 vrf management                  

!# Ping from vPC-B to vPC-A
ping 10.10.68.1 vrf management  

````

## ‚úÖ Port-Channel (Po) Status & Interfaces

````py
!# Summary of all port-channels and members
show port-channel summary

!# Detailed info for specific Po (e.g. Po1, Po2, Po100)
show interface port-channel <id>       

!# Trunk status, allowed VLANs
show interface port-channel <id> trunk 

!# Physical interface status (e.g. Eth1/2)
show interface ethernet <slot/port>    

!# LACP Neighbors
show lacp neighbor interface port-channel <id>  

````

# üóÉÔ∏è Resources

- https://www.cisco.com/c/es_mx/support/docs/switches/nexus-9000-series-switches/218333-understand-and-configure-nexus-9000-vpc.html
- https://www.youtube.com/live/uW--KhRzdEk?si=-0wyVkk1fJDk1TT6
- https://www.youtube.com/watch?v=fWCH39T-_fU
- https://youtu.be/kOb0r_-26Lw?si=XM5VzoYBd4AHofUf

---

<span align="center"> <p align="center"> ![giphy](https://user-images.githubusercontent.com/94720207/166587250-292d9a9f-e590-4c25-a678-d457e2268e85.gif) </p> </span> 

&nbsp;

<span align="center"> <p align="center"> _I hope this information was useful for someone_ </p> </span> 
<span align="center"> <p align="center"> _and please, don't forget to enjoy your days..._ </p> </span> 
<span align="center"> <p align="center"> _...It is getting dark... so dark..._ </p> </span> 

&nbsp;

<span align="center"> <p align="center"> _In the mist of the night you could see me come, where shadows move and Demons lie..._ </p> </span> 
<span align="center"> <p align="center"> _I am [Fz3r0 üíÄ](https://github.com/Fz3r0/) and the Sun no longer rises..._ </p> </span> 

---

---

> ![hecho en mexico 5](https://user-images.githubusercontent.com/94720207/166068790-fa1f243d-2db9-4810-a6e4-eb3c4ad23700.png)
>
> _- Hecho en M√©xico - by [Fz3r0 üíÄ](https://github.com/Fz3r0/)_  
>
> _"In the mist of the night you could see me come, where shadows move and Demons lie..."_ 
