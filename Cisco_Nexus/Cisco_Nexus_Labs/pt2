# üß†üèóÔ∏èüåê Cisco Nexus: `NX-OS - VXLAN/EVPN @ Tier 3 Fabric - PT1 : OSPF Underlay + Essentials`

![My Video](https://user-images.githubusercontent.com/94720207/165892585-b830998d-d7c5-43b4-a3ad-f71a07b9077e.gif)

### üê¶ Twitter  : [@fz3r0_OPs](https://twitter.com/Fz3r0_OPs)
### üê± Github  : [Fz3r0](https://github.com/fz3r0) 

---
 
#### Keywords: `Cisco` `CCNA` `CCNP` `Datacenter` `NX-OS` `Cisco Nexus` `Leaf & Spine` `DC Switching` `Modular Chassis` `Fixed Form Factor` `vPC` `ECMP` `FEX` `Fabric Extender` `Nexus 2000` `Nexus 5000` `Nexus 7000` `Nexus 9000`  `Port-Channel` `LAG` `VLAN` `VRF` `Overlay` `Underlay` `EVPN` `VXLAN`  `Spine Switch` `Leaf Switch` `Control Plane` `Forwarding Plane` `Supervisor Card` `Line Card`  `Redundant Power Supply` `Hot-swappable` `In-Service Software Upgrade (ISSU)` `High Availability`  `Twinax Cable` `SFP+` `QSFP28` `QSFP-DD` `10G` `25G` `40G` `100G` `400G`

---

<br>

# üìÑ `Index`

[üèóÔ∏è Cisco Nexus :: `NX-OS - VXLAN/EVPN @ Tier 3 Fabric - PT1 : OSPF Underlay + Essentials`](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-Nexus_3Tier-VXLAN-PT1_OSPF-Underlay+vPCs.md#%EF%B8%8F-cisco-nexus--nx-os---vxlanevpn--tier-3-fabric---pt1--ospf-underlay--essentials-1)
- [üéØ Objectives, Features & Protocols Covered](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-Nexus_3Tier-VXLAN-PT1_OSPF-Underlay+vPCs.md#-objectives-features--protocols-covered)
- [üé• Lab Proof of Concept (PoC) - Video](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-Nexus_3Tier-VXLAN-PT1_OSPF-Underlay+vPCs.md#-lab-proof-of-concept-poc---video)
- [üó∫Ô∏è Network Topology](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-Nexus_3Tier-VXLAN-PT1_OSPF-Underlay+vPCs.md#%EF%B8%8F-network-topology)
- [üìã Network Device Inventory, Interfaces & IP Addressing](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-Nexus_3Tier-VXLAN-PT1_OSPF-Underlay+vPCs.md#-network-device-inventory-interfaces--ip-addressing)
- [üìù Lab Notes](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-Nexus_3Tier-VXLAN-PT1_OSPF-Underlay+vPCs.md#-lab-notes)

[‚öôÔ∏è Devices Configurations](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-Nexus_3Tier-VXLAN-PT1_OSPF-Underlay+vPCs.md#%EF%B8%8F-devices-configurations)
- [üëëü•á `NX9-BGW-1A` - (Border Gateway - VPC-A)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-Nexus_3Tier-VXLAN-PT1_OSPF-Underlay+vPCs.md#-nx9-bgw-1a---border-gateway---vpc-a)
- [üëëü•à NX9-BGW-1B - (Border Gateway - VPC-B)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-NXOS_-_VXLAN-EVPN_Tier3-Fabric-PT1_OSPF%20Underlay%2BEssentials.md#-nx9-bgw-1b---border-gateway---vpc-b)
- [ü©ªü•á NX9-SPINE-1 - (SPINE 1)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-NXOS_-_VXLAN-EVPN_Tier3-Fabric-PT1_OSPF%20Underlay%2BEssentials.md#-nx9-spine-1---spine-1)
- [ü©ªü•à NX9-SPINE-2 - (SPINE 2)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-NXOS_-_VXLAN-EVPN_Tier3-Fabric-PT1_OSPF%20Underlay%2BEssentials.md#-nx9-spine-2---spine-2)
- [üåøü•á NX9-LEAF-1A - (LEAF 1 - VPC-A)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-NXOS_-_VXLAN-EVPN_Tier3-Fabric-PT1_OSPF%20Underlay%2BEssentials.md#-nx9-leaf-1a---leaf-1---vpc-a)
- [üåøü•à NX9-LEAF-1B - (LEAF 1 - VPC-B)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-NXOS_-_VXLAN-EVPN_Tier3-Fabric-PT1_OSPF%20Underlay%2BEssentials.md#-nx9-leaf-1b---leaf-1---vpc-b)
- [üåøü•á NX9-LEAF-2A - (LEAF 2 - VPC-A)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-NXOS_-_VXLAN-EVPN_Tier3-Fabric-PT1_OSPF%20Underlay+Essentials.md#-nx9-leaf-2a---leaf-2---vpc-a)
- [üåøü•à NX9-LEAF-2B - (LEAF 2 - VPC-B)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-NXOS_-_VXLAN-EVPN_Tier3-Fabric-PT1_OSPF%20Underlay+Essentials.md#-nx9-leaf-2b---leaf-2---vpc-b)
- [üîÄüîë IOS-SWITCH-MGMT - (Switch Layer 2 - Management)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-NXOS_-_VXLAN-EVPN_Tier3-Fabric-PT1_OSPF%20Underlay+Essentials.md#-ios-switch-mgmt---switch-layer-2---management)
- [üîÑüåê IOS-RT-WAN - (Router WAN)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-NXOS_-_VXLAN-EVPN_Tier3-Fabric-PT1_OSPF%20Underlay+Essentials.md#-ios-rt-wan---router-wan)
- [üåéüñß WAN-1 - (Internet Circuit)](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-NXOS_-_VXLAN-EVPN_Tier3-Fabric-PT1_OSPF%20Underlay+Essentials.md#-wan-1---internet-circuit)

[**üóÉÔ∏è Resources**](https://github.com/Fz3r0/Fz3r0_-_Cisco/blob/main/Cisco_Nexus/Cisco_Nexus_Labs/03.1-F0-NXOS_-_VXLAN-EVPN_Tier3-Fabric-PT1_OSPF%20Underlay+Essentials.md#%EF%B8%8F-resources)

# üèóÔ∏è Cisco Nexus :: `NX-OS - VXLAN/EVPN @ Tier 3 Fabric - PT1 : OSPF Underlay + Essentials`

This lab represents the first phase of a 4-part VXLAN/EVPN deployment using a 3 tier data center architecture (core, distribution y access), pero tambien puede servir en una tier 2 leaf & spine (core/distribuition y access). The main goal de este primer laboratiorio is to build a solid and scalable topology foundation, with a fully functional **underlay network** using a dynamic link state routing protocol like ISIS or OSPF (in this case I will use OSPF).

This lab represents Phase 1 of a 4-stage VXLAN/EVPN deployment, using a 3-tier data center architecture (Core, Distribution, and Access), but it can also be adapted to a 2-tier leaf & spine design depending on the scale.

The main goal of this first phase is to build a robust and scalable network foundation, using a dynamic link-state Layer 3 routing protocol (OSPF) to establish full IP reachability between all fabric nodes (Leafs, Spines, and Border Gateways). This routed infrastructure is known as the underlay, and it's a critical requirement for VXLAN overlays to operate correctly.

### VXLAN

VXLAN (Virtual Extensible LAN) is a network virtualization technology that extends Layer 2 segments across a Layer 3 fabric using IP encapsulation. It solves traditional VLAN scaling limitations and removes the need for STP (Spanning Tree Protocol) in the data center.

VXLAN encapsulates Ethernet frames inside UDP/IP packets using **`VXLAN tunnel endpoints (VTEPs)`**. These VTEPs are typically located on leaf switches or border gateways, and they handle both encapsulation and decapsulation of the Layer 2 traffic.

- üß© From the perspective of end-hosts (servers, VMs), the network still behaves like a traditional Layer 2 LAN. MAC addresses are preserved end-to-end, and hosts are unaware of any VXLAN encapsulation.

Each VXLAN segment is identified by a **`VNI (VXLAN Network Identifier)`**, analogous to a VLAN ID but scalable up to 16 million segments. 

- üß© For example, if the VTEP "Leaf-1" knows the VNI 5100 (which inlcudes VLANs 10,20,30), and also, the VTEP "Leaf-2" knows the same VNI 5100, then, both will be capable to comunicate Layer 2 Ethernet Frames (VLANs 10,20,30), using Layer 3 VXLAN encapsulation.

### üõ§Ô∏è VTEP: 

A VXLAN Tunnel Endpoint (VTEP) is a logical function implemented on a switch, typically a Leaf or Border Gateway, responsible for:

Encapsulating Layer 2 Ethernet frames into VXLAN/UDP/IP packets for outbound traffic.

Decapsulating VXLAN packets back into Layer 2 Ethernet frames for inbound traffic.

Each VTEP is assigned a unique IP address, usually taken from its Loopback0 interface, which is advertised via the underlay routing protocol (OSPF or IS-IS).
VTEPs maintain MAC-to-VTEP mappings, which are used to forward traffic to the correct remote tunnel endpoint. These mappings can be statically defined or dynamically learned via EVPN (covered in a later phase).

- üß™ In this lab, Leaf switches will act as VTEPs. Depending on the fabric design, Border Gateways (BGWs) may also operate as VTEPs, especially when external Layer 2 or Layer 3 domains need to be integrated into the VXLAN fabric.

On the host-facing side of the Leaf switches, the VTEPs typically connect to access layer devices or directly to servers via trunk interfaces carrying multiple VLANs. These servers may host systems such as virtual machines, CUSM, Cisco DNA Center, Active Directory, WLCs, or other enterprise services ‚Äî all of which communicate over what appears to be a traditional Layer 2 network.

From the hosts‚Äô perspective, nothing changes ‚Äî they remain unaware that their Layer 2 traffic is being transported across a routed Layer 3 fabric using VXLAN tunneling.

### üõ§Ô∏è VXLAN: `Underlay Network`

In a VXLAN/EVPN fabric, the **"UNDERLAY"** is the **physical or IP-based (layer 3) transport network that interconnects all fabric devices** (including Leafs, Spines, and Border Gateways). The network underlay ensures that VXLAN tunneled traffic (**the overlay network**) can be forwarded between tunnel endpoints on leaf switches. A reliable underlay is critical for encapsulating and forwarding VXLAN traffic across the fabric, enabling the overlay to function independently of the physical topology.

- The primary of the role of the **"UNDERLAY"** is to provide stable, routed IP connectivity between all **"VTEPs (VXLAN Tunnel Endpoints)"**.**

- This underlay typically runs a dynamic IGP like OSPF or IS-IS, using loopback interfaces as tunnel source IPs.

Existen 2 fases para tener una base de Underlay:

1. Crear un routeo solido entre todos los equipos (BGW, Spines, Leafs), en este caso una red OSPF con peer-links /31 entre los equipos. The **UNDERLAY** provides routed connectivity between all devices (Leafs, Spines, and BGWs) using point-to-point **`/31`** links and `Loopback 0` interfaces as unique router IDs (and future `VTEP` IDs).  IMPORTANTE: EL OSPF GENERA EL ENRUTAMIENTO UNICAST ENTRE LAS LOOPBACK 0 

2. Habilitar Multicast utilizando PIM, esto sirve para bl abla bla IMPORTANTE: EL PIM GENERA UN... ?

### PIM y Multicast Flooding

Para poder crear los tuneles entre 2 VTEPs se becesuta una tecnica de FLooding que es basado en grupos Multicast (tiene algun nombre esto vektor?). PAra eso se necesit aun protoclo de enrutamiento entre todos los dispositoivos nexus, que se llama PIM

PIM seleccona un router como el Rendevouz point (normalemnte es un Spine? cofnirma esto vektor...) y ese dispositivo es el que va a reicbir las ocnsultas de conde dw eneucntran los grupos multicast y van a anunciar quienes estan usando los mismo grupos mutlicast (similar a un ARP, debe estar buscando en la red quien estra ysando X direccion mtlicast) Es decir, Leaf1, le pregunta al RP (eg Spine1) quienes estan usando X grupo mutlicasty???? a pues fijaste que Leaf 2 y Leaf 3, y posteriormente creea un tunel a ambos leafs. De tan manera  QUE TODOS GENERAN UN UN TUNEL PARA CADA DISPOSITIVO, TODOS VAN A CONOCER TODAS LAS TABLAS/MAC DE TODOS.








---

**En este primer Lab me voy a enfocar en la primer fase del underlay y crear un link soliudo de OSPF entre los equipos, tambi√©n aprovechare pare crear los vPC y una slaida a internet tanto para la VRF de management como la default, es decir, una base completamente solida para la fase 1 de3l underlay, incluyendo las demas configuraicones secudnarias como nombres, ssh, disvoery, vPC's, Port Channels, etc, etc. This setup ensures that each node can reach any other at Layer 3, which is a core requirement for VXLAN overlays.**

En el siguiente laboratiorio me enfocar√© en la fase 2 del underlay que es habilitar multicast y PIM y Once this is in place, I will focus on enabling VXLAN in its raw form, to understand how encapsulation and VNI-based forwarding works without the help of EVPN. Finally, I will introduce EVPN control plane, which automates MAC/IP learning, scales the overlay, and brings the full power of modern data center fabrics. 



## üéØ Objectives, Features & Protocols Covered

- Configure OSPF underlay across Leafs, Spines, and Border Gateways (BGWs)
- Assign Loopback0 interfaces as Router IDs and VTEP candidates
- Use /31 subnets for routed point-to-point links between all fabric nodes
- Isolate management traffic using VRF management and VLAN 66 via a centralized L3 switch
- Set up a NAT gateway (IOS-RT-WAN) to simulate Internet access through a dedicated WAN-1 router
- Enable routing between VRF management and the default VRF to ensure end-to-end reachability
- Route VLAN 10 (default VRF) through OSPF on the BGWs
- Verify that both management and data traffic are reachable across the entire fabric

## üé• Lab Proof of Concept (PoC) - Video

- [**üëâ Click here to go to the PoC video üëà**](https://youtu.be/RL9hBT0H7UE)

## üó∫Ô∏è Network Topology

![image](https://github.com/user-attachments/assets/b18b82ea-5b3f-407b-b42e-10fe7fdb5b0e)

## üìã Network Device Inventory, Interfaces & IP Addressing

| üíª Device            | **üõ†Ô∏è Function**         | **üîå Interface / VLAN**     | **üåê IP / CIDR** | **üéØ Gateway** | **_üó∫Ô∏è Network_** | **_üì° Broadcast_** | **üîê VRF**     | **üìò Main Description**                      |
|----------------------|--------------------------|-----------------------------|-------------------|-----------------|------------------|---------------------|----------------|-----------------------------------------------|
| **`NX9-BGW-1A`**     | Border Gateway (vPC A)   | mgmt0                       | 10.10.66.11/24  | 10.10.66.254  | _10.10.66.0_    | _10.10.66.255_    | management    | OOB Management interface                    |
|                      |                          | Ethernet1/5                 | 10.10.255.1/30  | 10.10.255.2   | _10.10.255.0_   | _10.10.255.3_     | vpc-keepalive | vPC Keepalive to BGW-1B                     |
|                      |                          | port-channel100 (Eth1/6-7)  | ‚Äì               | ‚Äì             | _‚Äì_             | _‚Äì_               | default       | vPC Peer-Link trunk                         |
|                      |                          | loopback0                   | 10.10.1.11/32   | ‚Äì             | _‚Äì_             | _‚Äì_               | default       | OSPF Router ID (UNDERLAY-F0)                |
|                      |                          | Vlan10 (SVI)                | 10.10.1.211/24  | 10.10.1.254   | _10.10.1.0_     | _10.10.1.255_     | default       | SVI OSPF underlay to spines                 |
|                      |                          | Ethernet1/1                 | 10.10.1.100/31  | 10.10.1.101   | _10.10.1.100_   | _10.10.1.101_     | default       | OSPF to Spine-1                             |
|                      |                          | Ethernet1/2                 | 10.10.1.102/31  | 10.10.1.103   | _10.10.1.102_   | _10.10.1.103_     | default       | OSPF to Spine-2                             |
|                      |                          | Ethernet1/3.10              | 10.10.2.102/30  | 10.10.2.101   | _10.10.2.100_   | _10.10.2.103_     | default       | OSPF P2P to WAN Router (subinterface)       |
| **`NX9-BGW-1B`**     | Border Gateway (vPC B)   | mgmt0                       | 10.10.66.12/24  | 10.10.66.254  | _10.10.66.0_    | _10.10.66.255_    | management    | OOB Management interface                    |
|                      |                          | Ethernet1/5                 | 10.10.255.2/30  | 10.10.255.1   | _10.10.255.0_   | _10.10.255.3_     | vpc-keepalive | vPC Keepalive to BGW-1A                     |
|                      |                          | port-channel100 (Eth1/6-7)  | ‚Äì               | ‚Äì             | _‚Äì_             | _‚Äì_               | default       | vPC Peer-Link trunk                         |
|                      |                          | loopback0                   | 10.10.1.12/32   | ‚Äì             | _‚Äì_             | _‚Äì_               | default       | OSPF Router ID (UNDERLAY-F0)                |
|                      |                          | Vlan10 (SVI)                | 10.10.1.212/24  | 10.10.1.254   | _10.10.1.0_     | _10.10.1.255_     | default       | SVI OSPF underlay to spines                 |
|                      |                          | Ethernet1/1                 | 10.10.1.106/31  | 10.10.1.107   | _10.10.1.106_   | _10.10.1.107_     | default       | OSPF to Spine-2                             |
|                      |                          | Ethernet1/2                 | 10.10.1.104/31  | 10.10.1.105   | _10.10.1.104_   | _10.10.1.105_     | default       | OSPF to Spine-1                             |
|                      |                          | Ethernet1/3.10              | 10.10.2.106/30  | 10.10.2.105   | _10.10.2.104_   | _10.10.2.107_     | default       | OSPF P2P to WAN Router (subinterface)       |
| **`NX9-SPINE-1`**    | Spine Switch             | mgmt0                       | 10.10.66.13/24  | 10.10.66.254  | _10.10.66.0_    | _10.10.66.255_    | management    | OOB Management interface                    |
|                      |                          | Loopback0                   | 10.10.1.13/32   | -             | _-_             | _-_               | default       | OSPF Router ID                              |
|                      |                          | Vlan10                      | 10.10.1.213/24  | 10.10.1.254   | _10.10.1.0_     | _10.10.1.255_     | default       | OSPF SVI to Leafs/BGWs                      |
|                      |                          | Ethernet1/1                 | 10.10.1.101/31  | 10.10.1.100   | _10.10.1.100_   | _10.10.1.101_     | default       | OSPF to BGW-1A                              |
|                      |                          | Ethernet1/2                 | 10.10.1.105/31  | 10.10.1.104   | _10.10.1.104_   | _10.10.1.105_     | default       | OSPF to BGW-1B                              |
|                      |                          | Ethernet1/3                 | 10.10.1.108/31  | 10.10.1.108   | _10.10.1.108_   | _10.10.1.109_     | default       | OSPF to LEAF-1A                             |
|                      |                          | Ethernet1/4                 | 10.10.1.110/31  | 10.10.1.110   | _10.10.1.110_   | _10.10.1.111_     | default       | OSPF to LEAF-1B                             |
|                      |                          | Ethernet1/5                 | 10.10.1.112/31  | 10.10.1.112   | _10.10.1.112_   | _10.10.1.113_     | default       | OSPF to LEAF-2A                             |
|                      |                          | Ethernet1/6                 | 10.10.1.114/31  | 10.10.1.114   | _10.10.1.114_   | _10.10.1.115_     | default       | OSPF to LEAF-2B                             |
| **`NX9-SPINE-2`**    | Spine Switch             | mgmt0                       | 10.10.66.14/24  | 10.10.66.254  | _10.10.66.0_    | _10.10.66.255_    | management    | OOB Management interface                    |
|                      |                          | Loopback0                   | 10.10.1.14/32   | -             | _-_             | _-_               | default       | OSPF Router ID                              |
|                      |                          | Vlan10                      | 10.10.1.214/24  | 10.10.1.254   | _10.10.1.0_     | _10.10.1.255_     | default       | OSPF SVI to Leafs/BGWs                      |
|                      |                          | Ethernet1/1                 | 10.10.1.107/31  | 10.10.1.106   | _*10.10.1.106v_ | _10.10.1.107_     | default       | OSPF to BGW-1B                              |
|                      |                          | Ethernet1/2                 | 10.10.1.103/31  | 10.10.1.102   | _10.10.1.102_   | _10.10.1.103_     | default       | OSPF to BGW-1A                              |
|                      |                          | Ethernet1/3                 | 10.10.1.116/31  | 10.10.1.116   | _10.10.1.116_   | _10.10.1.117_     | default       | OSPF to LEAF-1A                             |
|                      |                          | Ethernet1/4                 | 10.10.1.118/31  | 10.10.1.118   | _10.10.1.118_   | _10.10.1.119_     | default       | OSPF to LEAF-1B                             |
|                      |                          | Ethernet1/5                 | 10.10.1.120/31  | 10.10.1.120   | _10.10.1.120_   | _10.10.1.121_     | default       | OSPF to LEAF-2A                             |
|                      |                          | Ethernet1/6                 | 10.10.1.122/31  | 10.10.1.122   | _10.10.1.122_   | _10.10.1.123_     | default       | OSPF to LEAF-2B                             |
| **`NX9-LEAF-1A`**    | Leaf vPC-A               | mgmt0                       | 10.10.66.15/24  | 10.10.66.254  | _10.10.66.0_    | _10.10.66.255_    | management    | OOB Management interface                    |
|                      |                          | Loopback0                   | 10.10.1.15/32   | -             | _-_             | _-_               | default       | OSPF Router ID                              |
|                      |                          | Vlan10                      | 10.10.1.215/24  | 10.10.1.254   | _10.10.1.0_     | _10.10.1.255_     | default       | SVI ‚Äì OSPF Peer Reachability                |
|                      |                          | Ethernet1/1                 | 10.10.1.109/31  | 10.10.1.108   | _10.10.1.108_   | _10.10.1.109_     | default       | OSPF to Spine-1                             |
|                      |                          | Ethernet1/2                 | 10.10.1.117/31  | 10.10.1.116   | _10.10.1.116_   | _10.10.1.117_     | default       | OSPF to Spine-2                             |
|                      |                          | Ethernet1/5                 | 10.10.255.1/30  | 10.10.255.2   | _10.10.255.0_   | _10.10.255.3_     | vpc-keepalive | vPC KeepAlive physical link                 |
|                      |                          | Po100 (Eth1/6-7)            | ‚Äì               | ‚Äì             | _‚Äì_             | _‚Äì_               | default       | vPC Peer-Link trunk (VLAN 10)               |
| **`NX9-LEAF-1B`**    | Leaf vPC-B               | mgmt0                       | 10.10.66.16/24  | 10.10.66.254  | _10.10.66.0_    | _10.10.66.255_    | management    | OOB Management interface                    |
|                      |                          | Loopback0                   | 10.10.1.16/32   | -             | _-_             | _-_               | default       | OSPF Router ID                              |
|                      |                          | Vlan10                      | 10.10.1.216/24  | 10.10.1.254   | _10.10.1.0_     | _10.10.1.255_     | default       | SVI ‚Äì OSPF Peer Reachability                |
|                      |                          | Ethernet1/1                 | 10.10.1.111/31  | 10.10.1.110   | _10.10.1.110_   | _10.10.1.111_     | default       | OSPF to Spine-1                             |
|                      |                          | Ethernet1/2                 | 10.10.1.119/31  | 10.10.1.118   | _10.10.1.118_   | _10.10.1.119_     | default       | OSPF to Spine-2                             |
|                      |                          | Ethernet1/5                 | 10.10.255.2/30  | 10.10.255.1   | _10.10.255.0_   | _10.10.255.3_     | vpc-keepalive | vPC KeepAlive physical link                 |
|                      |                          | Po100 (Eth1/6-7)            | ‚Äì               | ‚Äì             | _‚Äì_             | _‚Äì_               | default       | vPC Peer-Link trunk (VLAN 10)               |
| **`NX9-LEAF-2A`**    | Leaf vPC-A               | mgmt0                       | 10.10.66.17/24  | 10.10.66.254  | _10.10.66.0_    | _10.10.66.255_    | management    | OOB Management interface                    |
|                      |                          | Loopback0                   | 10.10.1.17/32   | -             | _-_             | _-_               | default       | OSPF Router ID                              |
|                      |                          | Vlan10                      | 10.10.1.217/24  | 10.10.1.254   | _10.10.1.0_     | _10.10.1.255_     | default       | SVI ‚Äì OSPF Peer Reachability                |
|                      |                          | Ethernet1/1                 | 10.10.1.113/31  | 10.10.1.112   | _10.10.1.112_   | _10.10.1.113_     | default       | OSPF to Spine-1                             |
|                      |                          | Ethernet1/2                 | 10.10.1.121/31  | 10.10.1.120   | _10.10.1.120_   | _10.10.1.121_     | default       | OSPF to Spine-2                             |
|                      |                          | Ethernet1/5                 | 10.10.255.1/30  | 10.10.255.2   | _10.10.255.0_   | _10.10.255.3_     | vpc-keepalive | vPC KeepAlive physical link                 |
|                      |                          | Po100 (Eth1/6-7)            | ‚Äì               | ‚Äì             | _‚Äì_             | _‚Äì_               | default       | vPC Peer-Link trunk (VLAN 10)               |
| **`NX9-LEAF-2B`**      | Leaf vPC-B               | mgmt0                       | 10.10.66.18/24  | 10.10.66.254  | _10.10.66.0_    | _10.10.66.255_    | management    | OOB Management interface                    |
|                      |                          | Loopback0                   | 10.10.1.18/32   | -             | _-_             | _-_               | default       | OSPF Router ID                              |
|                      |                          | Vlan10                      | 10.10.1.218/24  | 10.10.1.254   | _10.10.1.0_     | _10.10.1.255_     | default       | SVI ‚Äì OSPF Peer Reachability                |
|                      |                          | Ethernet1/1                 | 10.10.1.115/31  | 10.10.1.114   | _10.10.1.114_   | _10.10.1.115_     | default       | OSPF to Spine-1                             |
|                      |                          | Ethernet1/2                 | 10.10.1.123/31  | 10.10.1.122   | _10.10.1.122_   | _10.10.1.123_     | default       | OSPF to Spine-2                             |
|                      |                          | Ethernet1/5                 | 10.10.255.2/30  | 10.10.255.1   | _10.10.255.0_   | _10.10.255.3_     | vpc-keepalive | vPC KeepAlive physical link                 |
|                      |                          | Po100 (Eth1/6-7)            | ‚Äì               | ‚Äì             | _‚Äì_             | _‚Äì_               | default       | vPC Peer-Link trunk (VLAN 10)               |
| **`IOS-SWITCH-MGMT`**| MGMT Switch              | VLAN66 (SVI)                | 10.10.66.250/24 | 10.10.66.254  | _10.10.66.0_    | _10.10.66.255_    | default       | SVI Gateway para red de management (Switch) |
|                      |                          | Eth0/0-3,1/0-3,2/1-3        | -               | -             | _-_             | _-_               | default       | Access ports para equipos de red (VLAN 66)  |
|                      |                          | Eth2/0                      | -               | -             | _-_             | _-_               | default       | Trunk hacia Router WAN (VLAN 66)            |
| **`IOS-RT-WAN`**     | WAN Router               | Loopback0                   | 10.10.1.254/32  | -             | _-_             | _-_               | default       | Router ID para OSPF proceso 10              |
|                      |                          | Eth0/0.66                   | 10.10.66.254/24 | -             | _10.10.66.0_    | _10.10.66.255_    | management    | Gateway VRF Management                      |
|                      |                          | Eth0/1.10                   | 10.10.2.101/30  | -             | _10.10.2.100_   | _10.10.2.103_     | default       | OSPF peer con BGW-1                         |
|                      |                          | Eth0/3.10                   | 10.10.2.105/30  | -             | _10.10.2.104_   | _10.10.2.107_     | default       | OSPF peer con BGW-2                         |
|                      |                          | Eth0/2                      | 123.1.1.2/30    | 123.1.1.1     | _123.1.1.0_     | _123.1.1.3_       | default       | Interfaz WAN con NAT hacia Internet         |
| **`WAN-1`**          | Internet ISP             | Eth0/0                      | 123.1.1.1/30    | -             | _123.1.1.0_     | _123.1.1.3_       | -             | Interfaz ISP que recibe tr√°fico NAT         |
|                      |                          | Loopback0                   | 8.8.8.8/32      | -             | _-_             | _-_               | -             | Loopback DNS Google #1                      |
|                      |                          | Loopback1                   | 8.8.4.4/32      | -             | _-_             | _-_               | -             | Loopback DNS Google #2                      |





## üìù Lab Notes

Credentials:

- Admin: `admin`
- Pass: `Adm1n.C1sc0`

Notes:

- During Nexus Switches start-up, select `skip` during "Abort Power On Auto Provisioning (yes - continue with normal setup, skip - bypass password and basic configuration, no - continue with Power On Auto Provisioning) (yes/skip/no)[no]: `skip`"
- The NX9-1 and NX9-2 must be powered on and configured before the edge routers, otherwise OSPF process 1 could bug/error.
- Se deben utilizar imagenes nexus 9k como minimo para soportar los vPC y VXLAN, minimo 8gb de RAM cada uno.
- en caso que el nexus al iniciar que quede en un prompt de "loader>" quiere decir que no inicio el Segundo Sistema operativo, recordar que nxos arranca con 2 , primero el kicks start y luego el SO, en caso de que se quede en `loader>` solo escribir "dir" y despues "boot NXOS.9.34234234" o la verison que se este usando. 
- Check that all virtual NX devices are powered on and have no CLI issues; sometimes they can hang or freeze when too many sessions are open or multiple processes are running. <br><br>
- Overlapping subnet warning (e.g. between Lo0 and VLAN10 `overlapping network for ipv4 address: 10.10.1.211/24 on vlan10, 10.10.1.11/32 already configured on lo0`) **is expected**.  It‚Äôs safe to ignore Loopback uses /32 for OSPF RID and can coexist with SVI in the same subnet.


# **‚öôÔ∏è Devices Configurations**

- Copy & Paste the configuration in each device CLI

## üëëü•á `NX9-BGW-1A` - (Border Gateway - VPC-A)

````py
configure terminal
banner motd $


#######################################################################################
#                                                                                     #
#                        - Fz3r0 :: Cisco Nexus Data Center -                         #
#                                                                                     #
#   * Github      : Fz3r0                                                             #
#   * Twitter     : @fz3r0_OPs                                                        #
#   * Youtube     : @fz3r0_OPs                                                        #
#                                                                                     #
# -._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-._.-=-._.-=-._.-=-.#
#                                                                                     #
#    NEXUS        : NX9-BGW-1A                                                        #
#    ROLE         : Border Gateway (A)                                                #
#                                                                                     #
#    MGMT         : 10.10.66.11/24                                                    #
#    LOGIN        : admin / admin.cisco                                               #
#                                                                                     #
#    VRFs:                                                                            #
#    - default                                                                        #
#    - management                                                                     #
#    - *vpc-keepalive                                                                 #
#                                                                                     #
#    VPCs:                                                                            #
#    - vPC Domain 666 (BGW-1A <==> BGW-1B)                                             #
#      * PeerLink  @ Po100                                                            #
#      * KeepAlive @ Eth5                                                             #
#                                                                                     #
#    PORT CHANNELS:                                                                   #
#    - None                                                                           #
#                                                                                     #
#     OSPF UNDERLAY                                                                   #
#    - OSPF ID    : UNDERLAY-F0                                                       #
#    - OSPF AREA  : 0.0.0.0 (Backbone)                                                #
#    - Lo0        : 10.10.1.11/32                                                     #
#    - RID        : 10.10.1.11                                                        #
#    - Peer-SVI   : 10.10.1.211/24 (VLAN 10 - OSPF-PEER)                              #
#                                                                                     #
#######################################################################################


$

!# NAMINGS, USERS, LICENSES, DISCOVERY
hostname NX9-BGW-1A
no password strength-check
username admin password admin.cisco role network-admin
cdp enable

!# MANAGEMENT INTERFACE & VRF (IP/GATEWAY)

!# Add DNS and Default Gateway to MGMT VLAN/VRF
vrf context management
   ip name-server 8.8.8.8 8.8.4.4
   ip route 0.0.0.0/0 10.10.66.254
!# Configure mgmt0 interface
interface mgmt0
   description ** MGMT INTERFACE **
   no shutdown
   vrf member management
   ip address 10.10.66.11/24
exit

!#######################################################################################
!#  FEATURES                                                                           #
!#######################################################################################

!# Port Channel & vPC:
feature vpc
feature lacp

!# Interface VLAN (for SVI)
feature interface-vlan

!# OSPF (Underlay)
feature ospf

!# Remote Connection
feature telnet
feature ssh

!# Discovery
feature lldp

!#######################################################################################
!#  vPC CONFIGURATION                                                                  #
!#######################################################################################

!# vPC Configuration: << vPC Domain 666 >> 

!# 1 - Create VRF "vpc-keepalive"
vrf context vpc-keepalive
   description ** Keepalive path for vPC control-plane **
exit

!# 2 - Create new "vpc-keepalive" physical interface for P2P link
interface Ethernet 1/5
   description ** vPC KeepAlive Link (A) **
   no shutdown
      no switchport
         vrf member vpc-keepalive
         ip address 10.10.255.1/30
exit

!# 3 - Create vPC Domain "666" and configure KeepAlive-Link (Primary = 100 (lower))
vpc domain 666
   peer-keepalive destination 10.10.255.2 source 10.10.255.1 vrf vpc-keepalive
      role priority 100              
      auto-recovery
      auto-recovery reload-delay 60
      delay restore 1             
      system-priority 1000             
exit

!# 4 - Configure vPC Peer Link - Port Channel 100 (Eth6 & Eth7)
interface ethernet 1/6
   description ** (Po100) vPC Peer-Link - Interface 1of2 **
   no shutdown
      channel-group 100 mode active
exit
interface ethernet 1/7
   description ** (Po100) vPC Peer-Link - Interface 2of2 **
   no shutdown
      channel-group 100 mode active
exit
interface port-channel 100
   description ** (Po100) vPC Peer-Link Port-Channel **
   no shutdown
      switchport
      switchport mode trunk
      switchport trunk allowed vlan 10
         vpc peer-link     
exit

!#######################################################################################
!#  OSPF (UNDERLAY)                                                                    #
!#######################################################################################

!# 1 - Activate OSPF Process
router ospf UNDERLAY-F0
   router-id 10.10.1.11
      log-adjacency-changes
exit

!# 2 - Configure Loopback 0 Interface
interface loopback 0
   description ** Loopback 0 - OSPF UNDERLAY **
      ip address 10.10.1.11/32
         ip router ospf UNDERLAY-F0 area 0.0.0.0
exit

!# =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-#

!# 4 - OSPF Peer Interfaces @ OSPF Neighbors: 

#! SVI for VLAN 10 - OSPF Reachability
vlan 10
   name VLAN10-OSPF-PEER-GW
exit
interface vlan 10
   description ** SVI-V10-OSPF-UNDERLAY-GW **
   no shutdown
      ip address 10.10.1.211/24 
exit
#! Static default route (Default Gateway) for OSPF underlay in default VRF
! ip route 0.0.0.0/0 10.10.1.254
ip route 0.0.0.0/0 10.10.2.101

!# INTERFACE :: ETH 1/1 @ SPINE-1 
interface ethernet1/1
   description ** OSPF Peer @ Spine-1 **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.100/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/2 @ SPINE-2
interface ethernet1/2
   description ** OSPF Peer @ Spine-2 **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.102/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!#######################################################################################
!#  WAN INTERFACE + L3 SUB-INTERFACE @ OSPF 10                                         #
!#######################################################################################

!# OSPF 10
router ospf 10
   router-id 10.10.1.11
exit

!# INTERFACE :: ETH 1/3 @ WAN ROUTER (OSPF 10)
interface Ethernet1/3
   description *** Link ‚Üí WAN ROUTER Eth0/1 ***
   no shutdown
   speed 1000
   duplex full
      no switchport
exit
!# SUB-INTERFACE
interface Ethernet1/3.10
   description *** Link ‚Üí WAN ROUTER Eth0/1 ***
   no shutdown
      encapsulation dot1q 10
      ip address 10.10.2.102/30
         ip router ospf 10 area 0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!#######################################################################################
!#  SAVE CHECKPOINT & CONFIGURATION                                                    #
!#######################################################################################

end
checkpoint fz3r0-2025-3tier-OSPF_base-NX9-BGW-1A
copy running-config startup-config

!
!


````

## üëëü•à `NX9-BGW-1B` - (Border Gateway - VPC-B)

````py
configure terminal
banner motd $


#######################################################################################
#                                                                                     #
#                        - Fz3r0 :: Cisco Nexus Data Center -                         #
#                                                                                     #
#   * Github      : Fz3r0                                                             #
#   * Twitter     : @fz3r0_OPs                                                        #
#   * Youtube     : @fz3r0_OPs                                                        #
#                                                                                     #
# -._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-._.-=-._.-=-._.-=-.#
#                                                                                     #
#    NEXUS        : NX9-BGW-1B                                                        #
#    ROLE         : Border Gateway (B)                                                #
#                                                                                     #
#    MGMT         : 10.10.66.12/24                                                    #
#    LOGIN        : admin / admin.cisco                                               #
#                                                                                     #
#    VRFs:                                                                            #
#    - default                                                                        #
#    - management                                                                     #
#    - *vpc-keepalive                                                                 #
#                                                                                     #
#    VPCs:                                                                            #
#    - vPC Domain 666 (BGW-1B <==> BGW1A)                                             #
#      * PeerLink  @ Po100                                                            #
#      * KeepAlive @ Eth5                                                             #
#                                                                                     #
#    PORT CHANNELS:                                                                   #
#    - None                                                                           #
#                                                                                     #
#     OSPF UNDERLAY                                                                   #
#    - OSPF ID    : UNDERLAY-F0                                                       #
#    - OSPF AREA  : 0.0.0.0 (Backbone)                                                #
#    - Lo0        : 10.10.1.12/32                                                     #
#    - RID        : 10.10.1.12                                                        #
#    - Peer-SVI   : 10.10.1.212/24 (VLAN 10 - OSPF-PEER)                              #
#                                                                                     #
#######################################################################################


$

!# NAMINGS, USERS, LICENSES, DISCOVERY
hostname NX9-BGW-1B
no password strength-check
username admin password admin.cisco role network-admin
cdp enable

!# MANAGEMENT INTERFACE & VRF (IP/GATEWAY)

!# Add DNS and Default Gateway to MGMT VLAN/VRF
vrf context management
   ip name-server 8.8.8.8 8.8.4.4
   ip route 0.0.0.0/0 10.10.66.254
!# Configure mgmt0 interface
interface mgmt0
   description ** MGMT INTERFACE **
   no shutdown
   vrf member management
   ip address 10.10.66.12/24
exit

!#######################################################################################
!#  FEATURES                                                                           #
!#######################################################################################

!# Port Channel & vPC:
feature vpc
feature lacp

!# Interface VLAN (for SVI)
feature interface-vlan

!# OSPF (Underlay)
feature ospf

!# Remote Connection
feature telnet
feature ssh

!# Discovery
feature lldp

!#######################################################################################
!#  vPC CONFIGURATION                                                                  #
!#######################################################################################

!# vPC Configuration: << vPC Domain 666 >> 

!# 1 - Create VRF "vpc-keepalive"
vrf context vpc-keepalive
   description ** Keepalive path for vPC control-plane **
exit

!# 2 - Create new "vpc-keepalive" physical interface for P2P link
interface Ethernet 1/5
   description ** vPC KeepAlive Link (B) **
   no shutdown
      no switchport
         vrf member vpc-keepalive
         ip address 10.10.255.2/30
exit

!# 3 - Create vPC Domain "666" and configure KeepAlive-Link (Secondary = 200 (higher))
vpc domain 666
   peer-keepalive destination 10.10.255.1 source 10.10.255.2 vrf vpc-keepalive
      role priority 200              
      auto-recovery
      auto-recovery reload-delay 60
      delay restore 1             
      system-priority 1000             
exit

!# 4 - Configure vPC Peer Link - Port Channel 100 (Eth6 & Eth7)
interface ethernet 1/6
   description ** (Po100) vPC Peer-Link - Interface 1of2 **
   no shutdown
      channel-group 100 mode active
exit
interface ethernet 1/7
   description ** (Po100) vPC Peer-Link - Interface 2of2 **
   no shutdown
      channel-group 100 mode active
exit
interface port-channel 100
   description ** (Po100) vPC Peer-Link Port-Channel **
   no shutdown
      switchport
      switchport mode trunk
      switchport trunk allowed vlan 10
         vpc peer-link     
exit

!#######################################################################################
!#  OSPF (UNDERLAY)                                                                    #
!#######################################################################################

!# 1 - Activate OSPF Process
router ospf UNDERLAY-F0
   router-id 10.10.1.12
      log-adjacency-changes
exit

!# 2 - Configure Loopback 0 Interface
interface loopback 0
   description ** Loopback 0 - OSPF UNDERLAY **
      ip address 10.10.1.12/32
         ip router ospf UNDERLAY-F0 area 0.0.0.0
exit

!# =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-#

!# 4 - OSPF Peer Interfaces @ OSPF Neighbors: 

#! SVI for VLAN 10 - OSPF Reachability
vlan 10
   name VLAN10-OSPF-PEER-GW
exit
interface vlan 10
   description ** SVI-V10-OSPF-UNDERLAY-GW **
   no shutdown
      ip address 10.10.1.212/24 
exit
!# Static default route (Default Gateway) for OSPF underlay in default VRF
! ip route 0.0.0.0/0 10.10.1.254
ip route 0.0.0.0/0 10.10.2.105

!# INTERFACE :: ETH 1/1 @ SPINE-2
interface ethernet1/1
   description ** OSPF Peer @ SPINE-2 **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.106/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/2 @ SPINE-1
interface ethernet1/2
   description ** OSPF Peer @ SPINE-1 **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.104/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!#######################################################################################
!#  WAN INTERFACE + L3 SUB-INTERFACE @ OSPF 10                                         #
!#######################################################################################

!# OSPF 10
router ospf 10
   router-id 10.10.1.12
exit

!# INTERFACE :: ETH 1/3 @ WAN ROUTER (OSPF 10)
interface Ethernet1/3
   description *** Link ‚Üí WAN ROUTER Eth0/1 ***
   no shutdown
   speed 1000
   duplex full
      no switchport
exit
!# SUB-INTERFACE
interface Ethernet1/3.10
   description *** Link ‚Üí WAN ROUTER Eth0/1 ***
   no shutdown
      encapsulation dot1q 10
      ip address 10.10.2.106/30
         ip router ospf 10 area 0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!#######################################################################################
!#  SAVE CHECKPOINT & CONFIGURATION                                                    #
!#######################################################################################

end
checkpoint fz3r0-2025-3tier-OSPF_base-NX9-BGW-1B
copy running-config startup-config

!
!


````

## ü©ªü•á `NX9-SPINE-1` - (SPINE 1)

````py
configure terminal
banner motd $


#######################################################################################
#                                                                                     #
#                        - Fz3r0 :: Cisco Nexus Data Center -                         #
#                                                                                     #
#   * Github      : Fz3r0                                                             #
#   * Twitter     : @fz3r0_OPs                                                        #
#   * Youtube     : @fz3r0_OPs                                                        #
#                                                                                     #
# -._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-._.-=-._.-=-._.-=-.#
#                                                                                     #
#    NEXUS        : NX9-SPINE-1                                                       #
#    ROLE         : SPINE 1                                                           #
#                                                                                     #
#    MGMT         : 10.10.66.13/24                                                    #
#    LOGIN        : admin / admin.cisco                                               #
#                                                                                     #
#    VRFs:                                                                            #
#    - default                                                                        #
#    - management                                                                     #
#                                                                                     #
#    VPCs:                                                                            #
#    - None                                                                           #
#                                                                                     #
#    PORT CHANNELS:                                                                   #
#    - None                                                                           #
#                                                                                     #
#     OSPF UNDERLAY                                                                   #
#    - OSPF ID    : UNDERLAY-F0                                                       #
#    - OSPF AREA  : 0.0.0.0 (Backbone)                                                #
#    - Lo0        : 10.10.1.13/32                                                     #
#    - RID        : 10.10.1.13                                                        #
#    - Peer-SVI   : 10.10.1.213/24 (VLAN 10 - OSPF-PEER)                              #
#                                                                                     #
#######################################################################################


$

!# NAMINGS, USERS, LICENSES, DISCOVERY
hostname NX9-SPINE-1
no password strength-check
username admin password admin.cisco role network-admin
cdp enable

!# MANAGEMENT INTERFACE & VRF (IP/GATEWAY)

!# Add DNS and Default Gateway to MGMT VLAN/VRF
vrf context management
   ip name-server 8.8.8.8 8.8.4.4
   ip route 0.0.0.0/0 10.10.66.254
!# Configure mgmt0 interface
interface mgmt0
   description ** MGMT INTERFACE **
   no shutdown
   vrf member management
   ip address 10.10.66.13/24
exit

!#######################################################################################
!#  FEATURES                                                                           #
!#######################################################################################

!# Interface VLAN (for SVI)
feature interface-vlan

!# OSPF (Underlay)
feature ospf

!# Remote Connection
feature telnet
feature ssh

!# Discovery
feature lldp

!#######################################################################################
!#  OSPF (UNDERLAY)                                                                    #
!#######################################################################################

!# 1 - Activate OSPF Process
router ospf UNDERLAY-F0
   router-id 10.10.1.13
      log-adjacency-changes
exit

!# 2 - Configure Loopback 0 Interface
interface loopback 0
   description ** Loopback 0 - OSPF UNDERLAY **
      ip address 10.10.1.13/32
         ip router ospf UNDERLAY-F0 area 0.0.0.0
exit

!# =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-#

!# 4 - OSPF Peer Interfaces @ OSPF Neighbors: 

#! SVI for VLAN 10 - OSPF Reachability
vlan 10
   name VLAN10-OSPF-PEER-GW
exit
interface vlan 10
   description ** SVI-V10-OSPF-UNDERLAY-GW **
   no shutdown
      ip address 10.10.1.213/24 
exit
#! Static default route (Default Gateway) for OSPF underlay in default VRF
ip route 0.0.0.0/0 10.10.1.254

!# INTERFACE :: ETH 1/1 @ BGW-1A
interface ethernet1/1
   description ** OSPF Peer @ BGW-1A **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.101/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/2 @ BGW-1B
interface ethernet1/2
   description ** OSPF Peer @ BGW-1B **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.105/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/3 @ LEAF-1A
interface ethernet1/3
   description ** OSPF Peer @ LEAF-1A **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.108/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/4 @ LEAF-1B
interface ethernet1/4
   description ** OSPF Peer @ LEAF-1B **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.110/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/5 @ LEAF-2A
interface ethernet1/5
   description ** OSPF Peer @ LEAF-2A **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.112/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/6 @ LEAF-2B
interface ethernet1/6
   description ** OSPF Peer @ LEAF-2B **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.114/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!#######################################################################################
!#  SAVE CHECKPOINT & CONFIGURATION                                                    #
!#######################################################################################

end
checkpoint fz3r0-2025-3tier-OSPF_base-NX9-SPINE-1
copy running-config startup-config

!
!


````

## ü©ªü•à `NX9-SPINE-2` - (SPINE 2)

````py
configure terminal
banner motd $


#######################################################################################
#                                                                                     #
#                        - Fz3r0 :: Cisco Nexus Data Center -                         #
#                                                                                     #
#   * Github      : Fz3r0                                                             #
#   * Twitter     : @fz3r0_OPs                                                        #
#   * Youtube     : @fz3r0_OPs                                                        #
#                                                                                     #
# -._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-._.-=-._.-=-._.-=-.#
#                                                                                     #
#    NEXUS        : NX9-SPINE-2                                                       #
#    ROLE         : SPINE 2                                                           #
#                                                                                     #
#    MGMT         : 10.10.66.14/24                                                    #
#    LOGIN        : admin / admin.cisco                                               #
#                                                                                     #
#    VRFs:                                                                            #
#    - default                                                                        #
#    - management                                                                     #
#                                                                                     #
#    VPCs:                                                                            #
#    - None                                                                           #
#                                                                                     #
#    PORT CHANNELS:                                                                   #
#    - None                                                                           #
#                                                                                     #
#     OSPF UNDERLAY                                                                   #
#    - OSPF ID    : UNDERLAY-F0                                                       #
#    - OSPF AREA  : 0.0.0.0 (Backbone)                                                #
#    - Lo0        : 10.10.1.14/32                                                     #
#    - RID        : 10.10.1.14                                                        #
#    - Peer-SVI   : 10.10.1.214/24 (VLAN 10 - OSPF-PEER)                              #
#                                                                                     #
#######################################################################################


$

!# NAMINGS, USERS, LICENSES, DISCOVERY
hostname NX9-SPINE-2
no password strength-check
username admin password admin.cisco role network-admin
cdp enable

!# MANAGEMENT INTERFACE & VRF (IP/GATEWAY)

!# Add DNS and Default Gateway to MGMT VLAN/VRF
vrf context management
   ip name-server 8.8.8.8 8.8.4.4
   ip route 0.0.0.0/0 10.10.66.254
!# Configure mgmt0 interface
interface mgmt0
   description ** MGMT INTERFACE **
   no shutdown
   vrf member management
   ip address 10.10.66.14/24
exit

!#######################################################################################
!#  FEATURES                                                                           #
!#######################################################################################

!# Interface VLAN (for SVI)
feature interface-vlan

!# OSPF (Underlay)
feature ospf

!# Remote Connection
feature telnet
feature ssh

!# Discovery
feature lldp

!#######################################################################################
!#  OSPF (UNDERLAY)                                                                    #
!#######################################################################################

!# 1 - Activate OSPF Process
router ospf UNDERLAY-F0
   router-id 10.10.1.14
      log-adjacency-changes
exit

!# 2 - Configure Loopback 0 Interface
interface loopback 0
   description ** Loopback 0 - OSPF UNDERLAY **
      ip address 10.10.1.14/32
         ip router ospf UNDERLAY-F0 area 0.0.0.0
exit

!# =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-#

!# 4 - OSPF Peer Interfaces @ OSPF Neighbors: 

#! SVI for VLAN 10 - OSPF Reachability
vlan 10
   name VLAN10-OSPF-PEER-GW
exit
interface vlan 10
   description ** SVI-V10-OSPF-UNDERLAY-GW **
   no shutdown
      ip address 10.10.1.214/24 
exit
#! Static default route (Default Gateway) for OSPF underlay in default VRF
ip route 0.0.0.0/0 10.10.1.254

!# INTERFACE :: ETH 1/1 @ BGW-1B
interface ethernet1/1
   description ** OSPF Peer @ BGW-1B **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.107/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/2 @ BGW-1A
interface ethernet1/2
   description ** OSPF Peer @ BGW-1A **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.103/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/3 @ LEAF-1A
interface ethernet1/3
   description ** OSPF Peer @ LEAF-1A **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.116/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/4 @ LEAF-1B
interface ethernet1/4
   description ** OSPF Peer @ LEAF-1B **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.118/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/5 @ LEAF-2A
interface ethernet1/5
   description ** OSPF Peer @ LEAF-2A **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.120/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/6 @ LEAF-2B
interface ethernet1/6
   description ** OSPF Peer @ LEAF-2B **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.122/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!#######################################################################################
!#  SAVE CHECKPOINT & CONFIGURATION                                                    #
!#######################################################################################

end
checkpoint fz3r0-2025-3tier-OSPF_base-NX9-SPINE-2
copy running-config startup-config

!
!


````






## üåøü•á `NX9-LEAF-1A` - (LEAF 1 - VPC-A)

````py
configure terminal
banner motd $


#######################################################################################
#                                                                                     #
#                        - Fz3r0 :: Cisco Nexus Data Center -                         #
#                                                                                     #
#   * Github      : Fz3r0                                                             #
#   * Twitter     : @fz3r0_OPs                                                        #
#   * Youtube     : @fz3r0_OPs                                                        #
#                                                                                     #
# -._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-._.-=-._.-=-._.-=-.#
#                                                                                     #
#    NEXUS        : NX9-LEAF-1A                                                       #
#    ROLE         : LEAF                                                              #
#                                                                                     #
#    MGMT         : 10.10.66.15/24                                                    #
#    LOGIN        : admin / admin.cisco                                               #
#                                                                                     #
#    VRFs:                                                                            #
#    - default                                                                        #
#    - management                                                                     #
#    - *vpc-keepalive                                                                 #
#                                                                                     #
#    VPCs:                                                                            #
#    - vPC Domain 666 (LEAF-1A <==> LEAF-1B)                                          #
#      * PeerLink  @ Po100                                                            #
#      * KeepAlive @ Eth5                                                             #
#                                                                                     #
#    PORT CHANNELS:                                                                   #
#    - None                                                                           #
#                                                                                     #
#     OSPF UNDERLAY                                                                   #
#    - OSPF ID    : UNDERLAY-F0                                                       #
#    - OSPF AREA  : 0.0.0.0 (Backbone)                                                #
#    - Lo0        : 10.10.1.15/32                                                     #
#    - RID        : 10.10.1.15                                                        #
#    - Peer-SVI   : 10.10.1.215/24 (VLAN 10 - OSPF-PEER)                              #
#                                                                                     #
#######################################################################################


$

!# NAMINGS, USERS, LICENSES, DISCOVERY
hostname NX9-LEAF-1A
no password strength-check
username admin password admin.cisco role network-admin
cdp enable

!# MANAGEMENT INTERFACE & VRF (IP/GATEWAY)

!# Add DNS and Default Gateway to MGMT VLAN/VRF
vrf context management
   ip name-server 8.8.8.8 8.8.4.4
   ip route 0.0.0.0/0 10.10.66.254
!# Configure mgmt0 interface
interface mgmt0
   description ** MGMT INTERFACE **
   no shutdown
   vrf member management
   ip address 10.10.66.15/24
exit

!#######################################################################################
!#  FEATURES                                                                           #
!#######################################################################################

!# Port Channel & vPC: (tba)
feature vpc
feature lacp

!# Interface VLAN (for SVI)
feature interface-vlan

!# OSPF (Underlay)
feature ospf

!# Remote Connection
feature telnet
feature ssh

!# Discovery
feature lldp

!#######################################################################################
!#  vPC CONFIGURATION                                                                  #
!#######################################################################################

!# vPC Configuration: << vPC Domain 666 >> 

!# 1 - Create VRF "vpc-keepalive"
vrf context vpc-keepalive
   description ** Keepalive path for vPC control-plane **
exit

!# 2 - Create new "vpc-keepalive" physical interface for P2P link
interface Ethernet 1/5
   description ** vPC KeepAlive Link (A) **
   no shutdown
      no switchport
         vrf member vpc-keepalive
         ip address 10.10.255.1/30
exit

!# 3 - Create vPC Domain "666" and configure KeepAlive-Link (Primary = 100 (lower))
vpc domain 666
   peer-keepalive destination 10.10.255.2 source 10.10.255.1 vrf vpc-keepalive
      role priority 100              
      auto-recovery
      auto-recovery reload-delay 60
      delay restore 1             
      system-priority 1000             
exit

!# 4 - Configure vPC Peer Link - Port Channel 100 (Eth6 & Eth7)
interface ethernet 1/6
   description ** (Po100) vPC Peer-Link - Interface 1of2 **
   no shutdown
      channel-group 100 mode active
exit
interface ethernet 1/7
   description ** (Po100) vPC Peer-Link - Interface 2of2 **
   no shutdown
      channel-group 100 mode active
exit
interface port-channel 100
   description ** (Po100) vPC Peer-Link Port-Channel **
   no shutdown
      switchport
      switchport mode trunk
      switchport trunk allowed vlan 10
         vpc peer-link     
exit

!#######################################################################################
!#  OSPF (UNDERLAY)                                                                    #
!#######################################################################################

!# 1 - Activate OSPF Process
router ospf UNDERLAY-F0
   router-id 10.10.1.15
      log-adjacency-changes
exit

!# 2 - Configure Loopback 0 Interface
interface loopback 0
   description ** Loopback 0 - OSPF UNDERLAY **
      ip address 10.10.1.15/32
         ip router ospf UNDERLAY-F0 area 0.0.0.0
exit

!# =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-#

!# 4 - OSPF Peer Interfaces @ OSPF Neighbors: 

#! SVI for VLAN 10 - OSPF Reachability
vlan 10
   name VLAN10-OSPF-PEER-GW
exit
interface vlan 10
   description ** SVI-V10-OSPF-UNDERLAY-GW **
   no shutdown
      ip address 10.10.1.215/24 
exit
#! Static default route (Default Gateway) for OSPF underlay in default VRF
ip route 0.0.0.0/0 10.10.1.254

!# INTERFACE :: ETH 1/1 @ SPINE-1
interface ethernet1/1
   description ** OSPF Peer @ SPINE-1 **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.109/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/2 @ SPINE-2
interface ethernet1/2
   description ** OSPF Peer @ SPINE-2 **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.117/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!#######################################################################################
!#  SAVE CHECKPOINT & CONFIGURATION                                                    #
!#######################################################################################

end
checkpoint fz3r0-2025-3tier-OSPF_base-NX9-LEAF-1A
copy running-config startup-config

!
!


````

## üåøü•à `NX9-LEAF-1B` - (LEAF 1 - VPC-B)

````py
configure terminal
banner motd $


#######################################################################################
#                                                                                     #
#                        - Fz3r0 :: Cisco Nexus Data Center -                         #
#                                                                                     #
#   * Github      : Fz3r0                                                             #
#   * Twitter     : @fz3r0_OPs                                                        #
#   * Youtube     : @fz3r0_OPs                                                        #
#                                                                                     #
# -._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-._.-=-._.-=-._.-=-.#
#                                                                                     #
#    NEXUS        : NX9-LEAF-1B                                                       #
#    ROLE         : LEAF                                                              #
#                                                                                     #
#    MGMT         : 10.10.66.16/24                                                    #
#    LOGIN        : admin / admin.cisco                                               #
#                                                                                     #
#    VRFs:                                                                            #
#    - default                                                                        #
#    - management                                                                     #
#    - *vpc-keepalive                                                                 #
#                                                                                     #
#    VPCs:                                                                            #
#    - vPC Domain 666 (LEAF-1B <==> LEAF-1A)                                          #
#      * PeerLink  @ Po100                                                            #
#      * KeepAlive @ Eth5                                                             #
#                                                                                     #
#    PORT CHANNELS:                                                                   #
#    - None                                                                           #
#                                                                                     #
#     OSPF UNDERLAY                                                                   #
#    - OSPF ID    : UNDERLAY-F0                                                       #
#    - OSPF AREA  : 0.0.0.0 (Backbone)                                                #
#    - Lo0        : 10.10.1.16/32                                                     #
#    - RID        : 10.10.1.16                                                        #
#    - Peer-SVI   : 10.10.1.216/24 (VLAN 10 - OSPF-PEER)                              #
#                                                                                     #
#######################################################################################


$

!# NAMINGS, USERS, LICENSES, DISCOVERY
hostname NX9-LEAF-1B
no password strength-check
username admin password admin.cisco role network-admin
cdp enable

!# MANAGEMENT INTERFACE & VRF (IP/GATEWAY)

!# Add DNS and Default Gateway to MGMT VLAN/VRF
vrf context management
   ip name-server 8.8.8.8 8.8.4.4
   ip route 0.0.0.0/0 10.10.66.254
!# Configure mgmt0 interface
interface mgmt0
   description ** MGMT INTERFACE **
   no shutdown
   vrf member management
   ip address 10.10.66.16/24
exit

!#######################################################################################
!#  FEATURES                                                                           #
!#######################################################################################

!# Port Channel & vPC: (tba)
feature vpc
feature lacp

!# Interface VLAN (for SVI)
feature interface-vlan

!# OSPF (Underlay)
feature ospf

!# Remote Connection
feature telnet
feature ssh

!# Discovery
feature lldp

!#######################################################################################
!#  vPC CONFIGURATION                                                                  #
!#######################################################################################

!# vPC Configuration: << vPC Domain 666 >> 

!# 1 - Create VRF "vpc-keepalive"
vrf context vpc-keepalive
   description ** Keepalive path for vPC control-plane **
exit

!# 2 - Create new "vpc-keepalive" physical interface for P2P link
interface Ethernet 1/5
   description ** vPC KeepAlive Link (B) **
   no shutdown
      no switchport
         vrf member vpc-keepalive
         ip address 10.10.255.2/30
exit

!# 3 - Create vPC Domain "666" and configure KeepAlive-Link (Secondary = 200 (higher))
vpc domain 666
   peer-keepalive destination 10.10.255.1 source 10.10.255.2 vrf vpc-keepalive
      role priority 200              
      auto-recovery
      auto-recovery reload-delay 60
      delay restore 1             
      system-priority 1000             
exit

!# 4 - Configure vPC Peer Link - Port Channel 100 (Eth6 & Eth7)
interface ethernet 1/6
   description ** (Po100) vPC Peer-Link - Interface 1of2 **
   no shutdown
      channel-group 100 mode active
exit
interface ethernet 1/7
   description ** (Po100) vPC Peer-Link - Interface 2of2 **
   no shutdown
      channel-group 100 mode active
exit
interface port-channel 100
   description ** (Po100) vPC Peer-Link Port-Channel **
   no shutdown
      switchport
      switchport mode trunk
      switchport trunk allowed vlan 10
         vpc peer-link     
exit

!#######################################################################################
!#  OSPF (UNDERLAY)                                                                    #
!#######################################################################################

!# 1 - Activate OSPF Process
router ospf UNDERLAY-F0
   router-id 10.10.1.16
      log-adjacency-changes
exit

!# 2 - Configure Loopback 0 Interface
interface loopback 0
   description ** Loopback 0 - OSPF UNDERLAY **
      ip address 10.10.1.16/32
         ip router ospf UNDERLAY-F0 area 0.0.0.0
exit

!# =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-#

!# 4 - OSPF Peer Interfaces @ OSPF Neighbors: 

#! SVI for VLAN 10 - OSPF Reachability
vlan 10
   name VLAN10-OSPF-PEER-GW
exit
interface vlan 10
   description ** SVI-V10-OSPF-UNDERLAY-GW **
   no shutdown
      ip address 10.10.1.216/24 
exit
#! Static default route (Default Gateway) for OSPF underlay in default VRF
ip route 0.0.0.0/0 10.10.1.254

!# INTERFACE :: ETH 1/1 @ SPINE-1
interface ethernet1/1
   description ** OSPF Peer @ SPINE-1 **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.111/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/2 @ SPINE-2
interface ethernet1/2
   description ** OSPF Peer @ SPINE-2 **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.119/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!#######################################################################################
!#  SAVE CHECKPOINT & CONFIGURATION                                                    #
!#######################################################################################

end
checkpoint fz3r0-2025-3tier-OSPF_base-NX9-LEAF-1B
copy running-config startup-config

!
!


````

## üåøü•á `NX9-LEAF-2A` - (LEAF 2 - VPC-A)

````py
configure terminal
banner motd $


#######################################################################################
#                                                                                     #
#                        - Fz3r0 :: Cisco Nexus Data Center -                         #
#                                                                                     #
#   * Github      : Fz3r0                                                             #
#   * Twitter     : @fz3r0_OPs                                                        #
#   * Youtube     : @fz3r0_OPs                                                        #
#                                                                                     #
# -._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-._.-=-._.-=-._.-=-.#
#                                                                                     #
#    NEXUS        : NX9-LEAF-2A                                                       #
#    ROLE         : LEAF                                                              #
#                                                                                     #
#    MGMT         : 10.10.66.17/24                                                    #
#    LOGIN        : admin / admin.cisco                                               #
#                                                                                     #
#    VRFs:                                                                            #
#    - default                                                                        #
#    - management                                                                     #
#    - *vpc-keepalive                                                                 #
#                                                                                     #
#    VPCs:                                                                            #
#    - vPC Domain 666 (LEAF-2A <==> LEAF-2B)                                          #
#      * PeerLink  @ Po100                                                            #
#      * KeepAlive @ Eth5                                                             #
#                                                                                     #
#    PORT CHANNELS:                                                                   #
#    - None                                                                           #
#                                                                                     #
#     OSPF UNDERLAY                                                                   #
#    - OSPF ID    : UNDERLAY-F0                                                       #
#    - OSPF AREA  : 0.0.0.0 (Backbone)                                                #
#    - Lo0        : 10.10.1.17/32                                                     #
#    - RID        : 10.10.1.17                                                        #
#    - Peer-SVI   : 10.10.1.217/24 (VLAN 10 - OSPF-PEER)                              #
#                                                                                     #
#######################################################################################


$

!# NAMINGS, USERS, LICENSES, DISCOVERY
hostname NX9-LEAF-2A
no password strength-check
username admin password admin.cisco role network-admin
cdp enable

!# MANAGEMENT INTERFACE & VRF (IP/GATEWAY)

!# Add DNS and Default Gateway to MGMT VLAN/VRF
vrf context management
   ip name-server 8.8.8.8 8.8.4.4
   ip route 0.0.0.0/0 10.10.66.254
!# Configure mgmt0 interface
interface mgmt0
   description ** MGMT INTERFACE **
   no shutdown
   vrf member management
   ip address 10.10.66.17/24
exit

!#######################################################################################
!#  FEATURES                                                                           #
!#######################################################################################

!# Port Channel & vPC: (tba)
feature vpc
feature lacp

!# Interface VLAN (for SVI)
feature interface-vlan

!# OSPF (Underlay)
feature ospf

!# Remote Connection
feature telnet
feature ssh

!# Discovery
feature lldp

!#######################################################################################
!#  vPC CONFIGURATION                                                                  #
!#######################################################################################

!# vPC Configuration: << vPC Domain 666 >> 

!# 1 - Create VRF "vpc-keepalive"
vrf context vpc-keepalive
   description ** Keepalive path for vPC control-plane **
exit

!# 2 - Create new "vpc-keepalive" physical interface for P2P link
interface Ethernet 1/5
   description ** vPC KeepAlive Link (A) **
   no shutdown
      no switchport
         vrf member vpc-keepalive
         ip address 10.10.255.1/30
exit

!# 3 - Create vPC Domain "666" and configure KeepAlive-Link (Primary = 100 (lower))
vpc domain 666
   peer-keepalive destination 10.10.255.2 source 10.10.255.1 vrf vpc-keepalive
      role priority 100              
      auto-recovery
      auto-recovery reload-delay 60
      delay restore 1             
      system-priority 1000             
exit

!# 4 - Configure vPC Peer Link - Port Channel 100 (Eth6 & Eth7)
interface ethernet 1/6
   description ** (Po100) vPC Peer-Link - Interface 1of2 **
   no shutdown
      channel-group 100 mode active
exit
interface ethernet 1/7
   description ** (Po100) vPC Peer-Link - Interface 2of2 **
   no shutdown
      channel-group 100 mode active
exit
interface port-channel 100
   description ** (Po100) vPC Peer-Link Port-Channel **
   no shutdown
      switchport
      switchport mode trunk
      switchport trunk allowed vlan 10
         vpc peer-link     
exit

!#######################################################################################
!#  OSPF (UNDERLAY)                                                                    #
!#######################################################################################

!# 1 - Activate OSPF Process
router ospf UNDERLAY-F0
   router-id 10.10.1.17
      log-adjacency-changes
exit

!# 2 - Configure Loopback 0 Interface
interface loopback 0
   description ** Loopback 0 - OSPF UNDERLAY **
      ip address 10.10.1.17/32
         ip router ospf UNDERLAY-F0 area 0.0.0.0
exit

!# =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-#

!# 4 - OSPF Peer Interfaces @ OSPF Neighbors: 

#! SVI for VLAN 10 - OSPF Reachability
vlan 10
   name VLAN10-OSPF-PEER-GW
exit
interface vlan 10
   description ** SVI-V10-OSPF-UNDERLAY-GW **
   no shutdown
      ip address 10.10.1.217/24 
exit
#! Static default route (Default Gateway) for OSPF underlay in default VRF
ip route 0.0.0.0/0 10.10.1.254

!# INTERFACE :: ETH 1/1 @ SPINE-1
interface ethernet1/1
   description ** OSPF Peer @ SPINE-1 **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.113/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/2 @ SPINE-2
interface ethernet1/2
   description ** OSPF Peer @ SPINE-2 **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.121/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!#######################################################################################
!#  SAVE CHECKPOINT & CONFIGURATION                                                    #
!#######################################################################################

end
checkpoint fz3r0-2025-3tier-OSPF_base-NX9-LEAF-2A
copy running-config startup-config

!
!


````

## üåøü•à `NX9-LEAF-2B` - (LEAF 2 - VPC-B)

````py
configure terminal
banner motd $


#######################################################################################
#                                                                                     #
#                        - Fz3r0 :: Cisco Nexus Data Center -                         #
#                                                                                     #
#   * Github      : Fz3r0                                                             #
#   * Twitter     : @fz3r0_OPs                                                        #
#   * Youtube     : @fz3r0_OPs                                                        #
#                                                                                     #
# -._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-._.-=-._.-=-._.-=-.#
#                                                                                     #
#    NEXUS        : NX9-LEAF-2B                                                       #
#    ROLE         : LEAF                                                              #
#                                                                                     #
#    MGMT         : 10.10.66.18/24                                                    #
#    LOGIN        : admin / admin.cisco                                               #
#                                                                                     #
#    VRFs:                                                                            #
#    - default                                                                        #
#    - management                                                                     #
#    - *vpc-keepalive                                                                 #
#                                                                                     #
#    VPCs:                                                                            #
#    - vPC Domain 666 (LEAF-2A <==> LEAF-2B)                                          #
#      * PeerLink  @ Po100                                                            #
#      * KeepAlive @ Eth5                                                             #
#                                                                                     #
#    PORT CHANNELS:                                                                   #
#    - None                                                                           #
#                                                                                     #
#     OSPF UNDERLAY                                                                   #
#    - OSPF ID    : UNDERLAY-F0                                                       #
#    - OSPF AREA  : 0.0.0.0 (Backbone)                                                #
#    - Lo0        : 10.10.1.18/32                                                     #
#    - RID        : 10.10.1.18                                                        #
#    - Peer-SVI   : 10.10.1.218/24 (VLAN 10 - OSPF-PEER)                              #
#                                                                                     #
#######################################################################################


$

!# NAMINGS, USERS, LICENSES, DISCOVERY
hostname NX9-LEAF-2B
no password strength-check
username admin password admin.cisco role network-admin
cdp enable

!# MANAGEMENT INTERFACE & VRF (IP/GATEWAY)

!# Add DNS and Default Gateway to MGMT VLAN/VRF
vrf context management
   ip name-server 8.8.8.8 8.8.4.4
   ip route 0.0.0.0/0 10.10.66.254
!# Configure mgmt0 interface
interface mgmt0
   description ** MGMT INTERFACE **
   no shutdown
   vrf member management
   ip address 10.10.66.18/24
exit

!#######################################################################################
!#  FEATURES                                                                           #
!#######################################################################################

!# Port Channel & vPC: (tba)
feature vpc
feature lacp

!# Interface VLAN (for SVI)
feature interface-vlan

!# OSPF (Underlay)
feature ospf

!# Remote Connection
feature telnet
feature ssh

!# Discovery
feature lldp

!#######################################################################################
!#  vPC CONFIGURATION                                                                  #
!#######################################################################################

!# vPC Configuration: << vPC Domain 666 >> 

!# 1 - Create VRF "vpc-keepalive"
vrf context vpc-keepalive
   description ** Keepalive path for vPC control-plane **
exit

!# 2 - Create new "vpc-keepalive" physical interface for P2P link
interface Ethernet 1/5
   description ** vPC KeepAlive Link (B) **
   no shutdown
      no switchport
         vrf member vpc-keepalive
         ip address 10.10.255.2/30
exit

!# 3 - Create vPC Domain "666" and configure KeepAlive-Link (Secondary = 200 (higher))
vpc domain 666
   peer-keepalive destination 10.10.255.1 source 10.10.255.2 vrf vpc-keepalive
      role priority 200              
      auto-recovery
      auto-recovery reload-delay 60
      delay restore 1             
      system-priority 1000             
exit

!# 4 - Configure vPC Peer Link - Port Channel 100 (Eth6 & Eth7)
interface ethernet 1/6
   description ** (Po100) vPC Peer-Link - Interface 1of2 **
   no shutdown
      channel-group 100 mode active
exit
interface ethernet 1/7
   description ** (Po100) vPC Peer-Link - Interface 2of2 **
   no shutdown
      channel-group 100 mode active
exit
interface port-channel 100
   description ** (Po100) vPC Peer-Link Port-Channel **
   no shutdown
      switchport
      switchport mode trunk
      switchport trunk allowed vlan 10
         vpc peer-link     
exit

!#######################################################################################
!#  OSPF (UNDERLAY)                                                                    #
!#######################################################################################

!# 1 - Activate OSPF Process
router ospf UNDERLAY-F0
   router-id 10.10.1.18
      log-adjacency-changes
exit

!# 2 - Configure Loopback 0 Interface
interface loopback 0
   description ** Loopback 0 - OSPF UNDERLAY **
      ip address 10.10.1.18/32
         ip router ospf UNDERLAY-F0 area 0.0.0.0
exit

!# =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-#

!# 4 - OSPF Peer Interfaces @ OSPF Neighbors: 

#! SVI for VLAN 10 - OSPF Reachability
vlan 10
   name VLAN10-OSPF-PEER-GW
exit
interface vlan 10
   description ** SVI-V10-OSPF-UNDERLAY-GW **
   no shutdown
      ip address 10.10.1.218/24 
exit
#! Static default route (Default Gateway) for OSPF underlay in default VRF
ip route 0.0.0.0/0 10.10.1.254

!# INTERFACE :: ETH 1/1 @ SPINE-1
interface ethernet1/1
   description ** OSPF Peer @ SPINE-1 **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.115/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!# INTERFACE :: ETH 1/2 @ SPINE-2
interface ethernet1/2
   description ** OSPF Peer @ SPINE-2 **
   no shutdown
   speed 1000
   duplex full
      no switchport
      ip address 10.10.1.123/31
         ip router ospf UNDERLAY-F0 area 0.0.0.0
         ip ospf network point-to-point
         ip ospf cost 1
         ip ospf hello-interval 1
         ip ospf dead-interval 4
exit

!#######################################################################################
!#  SAVE CHECKPOINT & CONFIGURATION                                                    #
!#######################################################################################

end
checkpoint fz3r0-2025-3tier-OSPF_base-NX9-LEAF-2B
copy running-config startup-config

!
!


````

## üîÄüîë `IOS-SWITCH-MGMT` - (Switch Layer 2 - Management) 

````py
enable
configure terminal
banner motd $


#######################################################################################
#                                                                                     #
#                        - Fz3r0 :: Cisco Nexus Data Center -                         #
#                                                                                     #
#   * Github      : Fz3r0                                                             #
#   * Twitter     : @fz3r0_OPs                                                        #
#   * Youtube     : @fz3r0_OPs                                                        #
#                                                                                     #
# -._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-._.-=-._.-=-._.-=-.#
#                                                                                     #
#    NEXUS        : IOS-SWITCH-MGMT                                                   #
#    ROLE         : L3 SWITCH - MANAGEMENT SWITCH                                     #
#                                                                                     #
#    MGMT         : 10.10.66.250/24 (V66 NETWORK GATEWAY-1)                           #
#    LOGIN        : admin / admin.cisco                                               #
#                                                                                     #
#    TRUNK:                                                                           #
#                                                                                     #
#    ACCESS:                                                                           #
#    - none                                                                           #
#                                                                                     #
#    PORT CHANNELS:                                                                   #
#    - None                                                                           #
#                                                                                     #
#######################################################################################


$

!# NAMINGS, USERS, LICENSES, DISCOVERY
hostname IOS-SWITCH-MGMT 
username admin password admin.cisco role network-admin

!#######################################################################################
!#  VLANS                                                                              #
!#######################################################################################

vlan 66
   name V66-MGMT-VRFmgmt
exit

!#######################################################################################
!#  MANAGEMENT SVI & INTERFACE                                                         #
!#######################################################################################

!# INTERFACE :: SVI @ MGMT

interface vlan 66
   description ** SVI-V66-MGMT **
   no shutdown
      ip address 10.10.66.250 255.255.255.0 
exit
#! Default GW for mgmt @ MGMT switch (ONLY FOR LAN TRAFFIC!!!)
! ip default-gateway 10.10.66.254
#! IP Routing + IP Route = To get to Internet
ip routing
ip route 0.0.0.0 0.0.0.0 10.10.66.254

!#######################################################################################
!#  ALL INTERFACES = ACCESS VLAN 66 MANAGEMENT                                         #
!#######################################################################################

!# INTERFACE :: ALL @ SWITCH-L2 & LAN (Access) :: VRF management
interface range ethernet0/0-3,ethernet1/0-3,ethernet2/1-3
   description ** Access MGMT @ Network Devices - VRF: management **
   no shutdown
   duplex full
      switchport
      switchport mode access
      switchport access vlan 66
exit

!#######################################################################################
!#  TRUNK INTERFACES (VRF: management) ==>> @ ROUTER-WAN                               #
!#######################################################################################

!# INTERFACE :: Eth 2/0 @ ROUTER-WAN 
interface ethernet 2/0
   description ** Trunk @ ROUTER-WAN **
   no shutdown
   duplex full
      switchport
      switchport trunk encapsulation dot1q
      switchport mode trunk
      switchport trunk allowed vlan 66
exit

!#######################################################################################
!#  SAVE CONFIGURATION                                                                 #
!#######################################################################################

end
write memory


!
!

````







## üîÑüåê `IOS-RT-WAN` - (Router WAN) 

````py
enable
configure terminal
banner motd $


#######################################################################################
#                                                                                     #
#                        - Fz3r0 :: Cisco Nexus Data Center -                         #
#                                                                                     #
#   * Github      : Fz3r0                                                             #
#   * Twitter     : @fz3r0_OPs                                                        #
#   * Youtube     : @fz3r0_OPs                                                        #
#                                                                                     #
# -._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-._.-=-._.-=-._.-=-.#
#                                                                                     #
#    NEXUS        : IOS-RT-WAN                                                        #
#    ROLE         : WAN ROUTER / NAT GATEWAY                                          #
#                                                                                     #
#    MGMT         : 10.10.66.254/24 (V66 NETWORK GATEWAY-1)                           #
#    LOGIN        : admin / admin.cisco                                               #
#                                                                                     #
#    TRUNK:                                                                           #
#                                                                                     #
#    ACCESS:                                                                          #
#    - none                                                                           #
#                                                                                     #
#    PORT CHANNELS:                                                                   #
#    - None                                                                           #
#                                                                                     #
#######################################################################################


$

!# NAMINGS, USERS, LICENSES, DISCOVERY
hostname IOS-RT-WAN

!#######################################################################################
!#  ENABLE IP ROUTING                                                                  #
!#######################################################################################

!# Enables the router to forward packets BETWEEN DIFFERENT NETWORKS (turns on Layer 3 routing between management & default VRFs)
ip routing

!#######################################################################################
!#  L3 INTERFACE & SUB-INTERFACE @ LAN - VRF: management / VLAN 66                     #
!#######################################################################################

#! L3 PHYSICAL INTERFACE @ GATEWAY FOR LAN - VRF: management / VLAN 66
#! Gateway Sub-Interfaces @ LAN
interface Ethernet 0/0
   description ** Physical Link to -> IOS-SW-WAN **
   no shutdown
   duplex full
exit
#! L3 SUB-INTERFACE @ GATEWAY FOR LAN - VRF: management / VLAN 66
interface Ethernet 0/0.66
   description ** V66 Sub-Interface for -> IOS-SW-WAN **
   no shutdown
      encapsulation dot1Q 66
      ip address 10.10.66.254 255.255.255.0
         ip nat inside
exit

!#######################################################################################
!#  OSPF Peer-Links to BGW1 & BGW2                                                     #
!#######################################################################################

router ospf 10 
   router-id 10.10.1.254
      !# OSPF Peers
      network 10.10.2.100 0.0.0.3 area 0
      network 10.10.2.104 0.0.0.3 area 0
      !# mgmt network routing trick!
      network 10.10.66.0 0.0.0.255 area 0    
exit

interface Loopback 0
   description ** Loopback for OSPF 10 **
   no shutdown 
      ip address 10.10.1.254 255.255.255.255
exit

!#  L3 INTERFACE & SUB-INTERFACE @ LAN - VRF: default / VLAN 10 (BGW1 link)    

#! L3 PHYSICAL INTERFACE @ OSPF PEER-LINK @ BGW-1
interface Ethernet0/1
   description ** Physical Link to -> BGW-1 **
   no shutdown
   duplex full
exit
#! L3 SUB-INTERFACE @ GATEWAY FOR LAN - VRF: management / VLAN 66
interface Ethernet0/1.10
   description ** V10 Sub-Interface for -> BGW-1 **
   no shutdown
      encapsulation dot1Q 10
      ip address 10.10.2.101 255.255.255.252
         ip nat inside
            ip ospf network point-to-point
            ip ospf cost 1
            ip ospf hello-interval 1
            ip ospf dead-interval 4
exit

!#  L3 INTERFACE & SUB-INTERFACE @ LAN - VRF: default / VLAN 10 (BGW2 link)          

#! L3 PHYSICAL INTERFACE @ OSPF PEER-LINK @ BGW-2
interface Ethernet0/3
   description ** Physical Link to -> BGW-2 **
   no shutdown
   duplex full
exit
#! L3 SUB-INTERFACE @ GATEWAY FOR LAN - VRF: management / VLAN 66
interface Ethernet0/3.10
   description ** V10 Sub-Interface for -> BGW-2 **
   no shutdown
      encapsulation dot1Q 10
      ip address 10.10.2.105 255.255.255.252
         ip nat inside
            ip ospf network point-to-point
            ip ospf cost 1
            ip ospf hello-interval 1
            ip ospf dead-interval 4
exit

!#######################################################################################
!#  L3 INTERFACE @ WAN + NAT TRANSLATION / INTERNET // OUTSIDE                         #
!#######################################################################################

!# WAN INTERFACE (NAT OUTSIDE) [Default Route @ Internet]
interface Ethernet 0/2
   description ** Link-to-WAN-1_INTERNET **
   no shutdown
   duplex full
      ip address 123.1.1.2 255.255.255.252
         ip nat outside
exit
!# Ruta por defecto hacia la nube Google
ip route 0.0.0.0 0.0.0.0 123.1.1.1

!#######################################################################################
!#  NAT TRANSLATION CONFIGURATION, INSIDE-OUTSIDE                                      #
!#######################################################################################

!# ACL que define el trafico interno a traducir
ip access-list extended NAT_INSIDE
   permit ip 10.10.0.0 0.0.255.255 any


!# Overload all matching inside traffic to the WAN interface address
ip nat inside source list NAT_INSIDE interface Ethernet 0/2 overload

!#######################################################################################
!#  SAVE CONFIGURATION                                                                 #
!#######################################################################################

end
write memory

!
!


````

## üåéüñß `WAN-1` - (Internet Circuit)

````py
!###############
!# WAN-1 (IOS) #
!###############

!# Namings
enable
configure terminal
hostname WAN-1

!# WAN Interface
interface Ethernet 0/0
  no shutdown
  duplex full  
  description LINK-TO-NETWORK
  ip address 123.1.1.1 255.255.255.252

exit

!# Loopbacks (Google)
interface Loopback0
  description ** GOOGLE-DNS-1 **
  ip address 8.8.8.8 255.255.255.255
exit
interface Loopback1
  description ** GOOGLE-DNS-2 **
  ip address 8.8.4.4 255.255.255.255
exit

!# Default Route (opcional si usas default-route en el otro router)
ip route 0.0.0.0 0.0.0.0 123.1.1.2

end
write memory

!
!


````

# üóÉÔ∏è Resources

- https://www.youtube.com/watch?v=fWCH39T-_fU
- https://arubanetworking.hpe.com/techdocs/VSG/docs/040-dc-design/esp-dc-design-020-network-design/

![image](https://github.com/user-attachments/assets/097c8612-b84c-46cc-b86d-e33dec0322fe)


---

<span align="center"> <p align="center"> ![giphy](https://user-images.githubusercontent.com/94720207/166587250-292d9a9f-e590-4c25-a678-d457e2268e85.gif) </p> </span> 

&nbsp;

<span align="center"> <p align="center"> _I hope this information was useful for someone_ </p> </span> 
<span align="center"> <p align="center"> _and please, don't forget to enjoy your days..._ </p> </span> 
<span align="center"> <p align="center"> _...It is getting dark... so dark..._ </p> </span> 

&nbsp;

<span align="center"> <p align="center"> _In the mist of the night you could see me come, where shadows move and Demons lie..._ </p> </span> 
<span align="center"> <p align="center"> _I am [Fz3r0 üíÄ](https://github.com/Fz3r0/) and the Sun no longer rises..._ </p> </span> 

---

---

> ![hecho en mexico 5](https://user-images.githubusercontent.com/94720207/166068790-fa1f243d-2db9-4810-a6e4-eb3c4ad23700.png)
>
> _- Hecho en M√©xico - by [Fz3r0 üíÄ](https://github.com/Fz3r0/)_  
>
> _"In the mist of the night you could see me come, where shadows move and Demons lie..."_ 
